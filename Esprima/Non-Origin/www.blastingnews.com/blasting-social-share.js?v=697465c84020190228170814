(function (obj) {
  obj.fn.bnSocialShare = function () {
    var settings = {
      facebook: {
        url: 'https://www.facebook.com/sharer/sharer.php?u={{url}}&display=popup&ref=plugin&src=share_button&app_id=459022437543956',
        popup: {
          width: 626,
          height: 436
        }
      },
      twitter: {
        url: 'https://twitter.com/share?url={{url}}&via={{via}}&text={{description}}',
        popup: {
          width: 685,
          height: 500
        }
      },
      linkedin: {
        url: 'https://www.linkedin.com/shareArticle?mini=true&url={{url}}&title={{title}}&summary={{description}}+&source={{via}}',
        popup: {
          width: 600,
          height: 600
        }
      },
      whatsapp: {
        url: 'whatsapp://send?text={{description}}'
      },
      messenger: {
        url: 'fb-messenger://share?link={{description}}'
      }
    };
    var openPopUp = function (config, url) {
      var left = (window.innerWidth / 2) - (config.popup.width / 2)
      var top = (window.innerHeight / 2) - (config.popup.height / 2);
      return window.open(url, '', 'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=' + config.popup.width + ', height=' + config.popup.height + ', top=' + top + ', left=' + left)
    };
    var openLink = function (url) {
      window.location.href = url;
    };
    var doAction = function (config, url) {
      if(typeof config.popup !== 'undefined'){
        openPopUp(config, url);
      } else {
        openLink(url);
      }
    };
    var prepareUrl = function (config, dataSocial) {
      return config.url.replace(/{{url}}/g, encodeURIComponent(dataSocial.url)).replace(/{{title}}/g, encodeURIComponent(dataSocial.title)).replace(/{{description}}/g, encodeURIComponent(dataSocial.description)).replace(/{{media}}/g, encodeURIComponent(dataSocial.media)).replace(/{{via}}/g, encodeURIComponent(dataSocial.via));
    };
    return this.each(function () {
      var that = obj(this);
      var socialType = that.data('type');
      var config = settings[socialType] || null;
      if (!config) {
        obj.error('Sito social non settato.');
      }
      var dataSocial = {
        url: that.data('url') || '',
        title: that.data('title') || '',
        description: that.data('description') || '',
        media: that.data('media') || '',
        via: that.data('via') || ''
      };
      var url = prepareUrl(config, dataSocial);
      if (navigator.userAgent.match(/Android|IEMobile|BlackBerry|iPhone|iPad|iPod|Opera Mini/i)) {
        that.bind('touchstart', function (ev) {
          if (ev.originalEvent.touches.length > 1) {
            return;
          }
          that.data('touchWithoutScroll', true);
        }).bind('touchmove', function () {
          that.data('touchWithoutScroll', false);
          return;
        }).bind('touchend', function (ev) {
          ev.preventDefault();
          var j = that.data('touchWithoutScroll');
          if (ev.originalEvent.touches.length > 1 || !j) {
            return;
          }
          doAction(config, url);
        })
      } else {
        that.bind('click', function (ev) {
            ev.stopImmediatePropagation();
          ev.preventDefault();
          doAction(config, url);
        })
      }
    })
  }
})(jQuery);