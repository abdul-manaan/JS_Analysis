/*
 *  (c) 2000-2018 deviantART, Inc. All rights reserved.
 */
DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/glbl.js","jms/lib/pubsub.js"],function(){(function(e){function i(i){i=e(i);var n=e(document.createElement(i.get(0).nodeName));for(var t in{id:1,"class":1}){var o=i.attr(t);o&&n.attr(t,o)}return n.addClass("menu"),n}function n(){l.data("magic.restore",{scrollLeft:c.scrollLeft(),scrollTop:c.scrollTop(),duper_pause:Glbl("Duperbrowse.pause")}),Glbl("Duperbrowse.pause",!0),l.children(":visible").not(".menu-takeover").not(".magic-remain-visible").addClass("magic-hide").hide(),c.scrollLeft(0),c.scrollTop(0)}function t(){var e=l.data("magic.restore");l.children(".magic-hide").removeClass("magic-hide").show(),e&&(c.scrollLeft(e.scrollLeft),c.scrollTop(e.scrollTop),Glbl("Duperbrowse.pause",e.duper_pause)),l.data("magic.restore",!1)}function o(e){switch(e){case"up":case"down":return{up:1,down:-1}[e]*c.innerHeight();case"left":case"right":return{left:1,right:-1}[e]*c.innerWidth();default:throw"magicMenu: unknown direction: "+options.direction}}function a(e){var i=e.data("magic.menu"),n=e.data("magic.placeholder");i.removeClass("magic-menu").removeAttr("style"),n.replaceWith(i)}var s={open:function(){var i=e(this),t=l.children(":visible").add(i),a=i.data("magic.options"),s=o(a.direction);i.css({left:s}).show(),t.css("x",0).transition({x:-1*s},a.show_time,a.easing).promise().done(function(){n(),setTimeout(function(){i.css({position:"static",left:0}),t.css("transform",!1),PubSub.publish("MagicMenu.opened",{takeover:i})},50)})},close:function(){var i=e(this),n=l.children(".magic-hide").add(i),s=i.data("magic.options"),r=o(s.direction);t(),i.css({position:"fixed",left:r}),n.css("x",-1*r).transition({x:0},s.hide_time,s.easing).promise().done(function(){s.detach&&a(i),setTimeout(function(){i.remove(),n.css("transform",!1),PubSub.publish("MagicMenu.closed",{takeover:i})},50)})}},r={open:function(){var i=e(this),t=i.data("magic.options"),a=o(t.direction);i.css({top:a}).show().transition({top:0},t.show_time,t.easing).promise().done(function(){i.css({position:"static"}),n(),PubSub.publish("MagicMenu.opened",{takeover:i})})},close:function(){var i=e(this),n=i.data("magic.options"),s=o(n.direction);t(),i.css({position:"fixed",top:0}).transition({top:s},n.hide_time,n.easing).promise().done(function(){n.detach&&a(i),i.remove(),PubSub.publish("MagicMenu.closed",{takeover:i})})}},c=e(window),l=e(document.body);e.fn.magicMenu=function(n){var t=e.extend({},e.fn.magicMenu.defaults,n);return t.deep_clone=t.deeper_clone||t.deep_clone,this.on("click.magic",t.delegate,function(n){if(t.ignored_classes.length>0&&e(n.target).is("."+t.ignored_classes.join(",.")))return!0;t.prevent_default&&n.preventDefault(),l.find(".menu-takeover").remove();var o=e(t.target);if(!o.length)return vms_feature("dre")&&console.log("[magicMenu] aborted, cannot find menu",t),!1;for(var a=o.parents(":not(body,html)"),d=i(a.first()),u=d,p=1,m=a.length;m>p;p++){var f=i(a[p]).appendTo(u);u=f}if(t.detach){var g=e("<span>").hide(),h=o.after(g).detach();d.data({"magic.menu":h,"magic.placeholder":g})}else var h=o.clone(t.deep_clone,t.deeper_clone);switch(d.css({position:"fixed",top:0,left:0,width:"100%",height:c.innerHeight(),display:"none",zIndex:100,overflow:"auto"}).addClass("menu-takeover").data("magic.options",t).prependTo(l),h.css({display:"block",position:"relative",top:0,left:0,width:c.innerWidth(),minHeight:c.innerHeight(),height:"auto",boxSizing:"border-box",overflow:"visible",zIndex:101}).addClass("menu-magic").appendTo(u),t.direction){case"up":case"down":d.on({"open.magic":r.open,"close.magic":r.close});break;case"left":case"right":d.on({"open.magic":s.open,"close.magic":s.close});break;default:throw"magicMenu: unknown direction: "+t.direction}var v=e('<span class="magic-close-button"><tt>&#215;</tt></span>').appendTo(d);if(t.links_close){var b=h.find("a[href]");t.filter_fake_links&&(b=b.filter(function(){return 0===this.href.indexOf("javascript:")||"#"===this.href[0]?!1:!0})),v=v.add(b)}v.on("click.magic",function(){d.trigger("close")}),t.prepare&&"function"==typeof t.prepare&&t.prepare(d,h),d.trigger("open")}).end()},e.fn.magicMenu.defaults={target:null,delegate:null,detach:!1,ignored_classes:[],direction:"right",links_close:!0,prevent_default:!0,show_time:330,hide_time:330,easing:"cubic-bezier(.25, 1, .25, 1)",deep_clone:!1,deeper_clone:!1,filter_fake_links:!1},e.fn.magicMenu.hide=function(){e(".menu-takeover:visible").trigger("close")},e.fn.magicMenu.reset=function(){e(".magic-link").off("click.magic"),e(".menu-takeover").remove()}})(jQuery),window.DWait&&DWait.run("jms/lib/jquery/plugins/jquery.magicmenu.js")});
DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/jquery/plugins/jquery.transit.js","jms/lib/jquery/plugins/jquery.previewer.js","jms/lib/jquery/plugins/jquery.magicmenu.js","jms/lib/cookie.js","jms/lib/browser.js","jms/lib/pubsub.js",".domready"],function(){$(".overhead-main-menu-dropdown #search7 input[name=q]").prop("placeholder","Search"),function(){var e=Base.extend({isOpen:!1,hideAnimationDuration:500,constructor:function(e){if(this.$menu=e.menu,this.$menuButton=e.menuButton,this.htmlClass=e.htmlClass,this.$menuButton.on("click",this.open.bind(this)),this.$menu.find(".menu-close-button").on("click",this.close.bind(this)),e.tier2&&(e.tier2.on("click",this.tier2click.bind(this)),e.tier2back.on("click",this.tier2click.bind(this))),e.search){e.search.on("click",function(e){e.preventDefault(),$(this).find("input").focus()});var i=e.search.find('input[name="q"]');i.on("blur",function(){$(this).val(""),e.search.removeClass("open")}).on("focus",function(){e.search.addClass("open")}),i.on("keypress",function(e){13==e.which&&$(this).parents("form").submit()}),i.val()&&i.val().length>0&&e.search.addClass("open"),e.searchPadding&&e.search.parent().css("width","calc(100% + "+2*e.searchPadding+"px)")}e.onInit&&e.onInit.call(this),this.openCallback=e.onOpen,this.closeCallback=e.onClose},open:function(){this.isOpen=!0,$("html").addClass("header-menu-open"),this.$menuButton.addClass("active"),this.$menu.appendTo("body"),this.$menu.show(),setTimeout(function(){$("html").addClass(this.htmlClass)}.bind(this),100),PubSub.publish("AdhesionAd.disable"),this.openCallback&&this.openCallback.call(this)},close:function(e){$(e.target).hasClass("allow-default-action")||e.preventDefault(),this.isOpen=!1,$("html").removeClass(this.htmlClass),this.$menuButton.removeClass("active"),setTimeout(function(){this.$menu.hide(),this.$menu.removeClass("doTier2"),$("html").removeClass("header-menu-open")}.bind(this),this.hideAnimationDuration),PubSub.publish("AdhesionAd.enable"),this.closeCallback&&this.closeCallback.call(this)},toggle:function(){this.isOpen?this.close():this.open()},tier2click:function(){this.$menu.toggleClass("doTier2")}});new e({menu:$(".overhead-main-menu-dropdown"),menuButton:$("#overhead .overhead-main-menu"),htmlClass:"header-main-menu-open",tier2:$(".overhead-main-menu-dropdown-tier2"),tier2back:$(".overhead-main-menu-dropdown-tier2back"),search:$(".overhead-main-menu-dropdown-search"),searchPadding:20}),new e({menu:$(".overhead-user-menu-dropdown"),menuButton:$("#overhead .overhead-user"),htmlClass:"header-user-menu-open",onInit:function(){PubSub.subscribe({eventname:"Signup.show",subscriber:this,callback:this.open}),PubSub.subscribe({eventname:"MobileUserMenu.show",subscriber:this,callback:this.open}),this.isLogin=!((window.deviantART||{}).deviant||{}).id},onOpen:function(){this.isLogin&&(DiFi.pushPost("User","join_overlay_event",["show"],$.noop),DiFi.send())},onClose:function(){this.isLogin&&(DiFi.pushPost("User","join_overlay_event",["cancel"],$.noop),DiFi.send())}}),$("#overhead .gmbutton2searchcancel").off().on("click",function(){$(this).parent().find("input.gmbutton2").val("").focus(),$(this).removeClass("show")}),display_app_link=Browser.isKindleFire||Browser.isAndroid||Browser.isIOS,display_app_link||$(".mobile-app-link").hide();var i=function(){$(".overhead-user-menu-login input[name=ref]").val(window.location.href)};PubSub.subscribe({eventname:"Duperbrowse.opened",subscriber:this,callback:i}),PubSub.subscribe({eventname:"Duperbrowse.closed",subscriber:this,callback:i})}(),$("#activate-category-menu .left-menu").magicMenu({target:"#browse-sidebar, .browse-container .browse-left-bar",direction:"right",detach:!0,filter_fake_links:!0}),$("#activate-category-menu .right-menu").magicMenu({target:"#journalsSidebar, .right-bar-journal",direction:"left"}),$("#group .supergroup-buttons a.left").magicMenu({target:"#gruze-columns .gruze-sidebar.left-sidebar",direction:"right"}),$("#group .supergroup-buttons a.right").magicMenu({target:"#gruze-columns .gruze-sidebar.right-sidebar",direction:"left"}),$("#depths .footer_links .help-info").magicMenu({target:"#depths .footer_links .footer_tx_links",direction:"up"}),$("#messages .messages-head h1").magicMenu({target:"#messages table.messages td.messages-left",direction:"right"}),$("body").magicMenu({delegate:".dev-view-meta .deviationmenu.mobile-only",target:".dev-view-meta",direction:"left",deeper_clone:!0,prepare:function(e){var i=e.find('[name="gmi-ResourceViewFavouriteButton"]');i.removeAttr("gmindex");var n=GMI.query(e[0],"ResourceViewFavouriteButton")||{};n&&n[0]&&(n[0].gmi_node=i[0],n[0].gmiConstructor())}}),$("#bubbleview-notes .messages-head.bubbletop > h1").magicMenu({target:".pager-holder .pager2.pager-messages > .page2",direction:"right"}),$("#bubbleview-notes .notes-container").magicMenu({delegate:"ul.notes li.note, .note-controls a.button_create, .notes-left a.create-new-note, h2.mczone-title a.create-new-note, .header-buttons a.create-new-note",ignored_classes:["ts","ctrl","jslink","nomagicmenu","icon","note-details","note-preview"],target:"#bubbleview-notes .notes-right",direction:"left",links_close:!1,prevent_default:!0,deeper_clone:!0,prepare:function(e,i){e.find("div.compose_frame form a.preview_note").previewer({difi_call:["Notes","preview"],textarea:function(){return $(this).closest("div.compose_frame").find("form textarea#notebody")}}),Glbl("Site.is_eclipse")?(i.css({top:"60px",minHeight:e.height()-60}),PubSub.subscribe([{eventname:"MagicMenu.opened",subscriber:"mobile-ui",callback:function(i,n){var t=n.takeover.find(".menu-magic");t.css({top:"60px",minHeight:n.takeover.height()-60}),t.find(".mcb-note-body").css("height",e.height()-60-16-52),t.find(".note-compose-fieldset").css("height",e.height()-60-16-52)}}])):e.find("div.compose_frame a.clear_note").on("click.magic",function(){e.trigger("close")})}}),$("#show-gallery-sidebar a").magicMenu({target:"#gmi-GPage .gruze-sidebar",direction:"right",links_close:!1}),$("#group .smbutton.left.magic-link").magicMenu({target:"#pagemenu",direction:"right"}),$("#group .smbutton.right.magic-link").magicMenu({target:"div.mods-column-rr",direction:"left"}),window.DWait&&DWait.run("jms/mobile/ui.js")});
DWait.ready(["jms/lib/jquery/jquery.current.js",".domready"],function(){$(".overhead-user-menu-loginform").submit(function(e){return""===$(this).find("#username").val()||""===$(this).find("#password").val()?(e.preventDefault(),e.stopPropagation(),!1):void 0}),$(".overhead-user-menu-dropdown .goInput").on("click",function(){$(this).find(".itext").focus(),this.classList.add("inFocus")}),$(".overhead-user-menu-dropdown .itext").on("blur",function(){""===this.value&&this.parentNode.classList.remove("inFocus")}).on("focus",function(){this.parentNode.classList.add("inFocus")}).on("keypress",function(e){13===e.which&&$(this).parents("form").submit()}),$(".overhead-user-menu-dropdown .login, .overhead-user-menu-dropdown .logout").on("click",function(e){e.preventDefault(),$(this).closest("form").submit()}),$(".overhead-main-menu-restricted.loggedout").on("click",function(e){e.stopPropagation(),e.preventDefault(),$(".overhead-user").click()}),window.DWait&&DWait.run("jms/mobile/ui-mobile-profile-menu.js")});
DWait.ready(["jms/lib/jquery/jquery.current.js",".domready"],function(){var i=Base.extend({$el:null,$image:null,$container:null,initialized:!1,CONTAINER_MINHEIGHT:200,constructor:function(i){this.$el=$(i),this._init(),PubSub.subscribe({eventname:"Duperbrowse.opened",subscriber:this,callback:this._init})},_init:function(){this.initialized||(this.$image=this.$el.find("img.dev-content-full"),this.$image.length>0&&(this.$container=this.$image.parent(),this.$image.get(0).naturalWidth!==void 0?(this._setPadding(),this._resizeChallengeBox()):(this.$image.on("load",this._setPadding.bind(this)),this.$image.on("load",this._resizeChallengeBox.bind(this))),this.$image.attr("width")>window.innerWidth&&this.$image.on("click",this._handleImageClick.bind(this)),this.initialized=!0))},_handleImageClick:function(){this.$image.toggleClass("zoomed"),this._setPadding(),this._resizeChallengeBox()},_resizeChallengeBox:function(){this.$image.siblings(".dev-challenge-box").width(this.$image.width())},_setPadding:function(){var i,t=this.$image.height();i=!t||t>=this.CONTAINER_MINHEIGHT?0:this.CONTAINER_MINHEIGHT/2-Math.floor(t/2),this.$container.css("padding-top",i+"px")}});DWait.init("MobileDeviation.init",function(t){new i(t)}),window.DWait&&DWait.run("jms/mobile/deviation.view.js")});
DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/pubsub.js",".domready"],function(){DWait.init("MobileTabs.init",function(e){var t=$(e);t.on("click.tabsHandler",function(e){var a=$(e.target);0==a.parents(".tabs-root").length&&$(".tab-container",t).slideUp("fast",function(){$(this).removeClass("opened"),$(".tabs-root").removeClass("open"),$(".tab-button").removeClass("selected")})}),t.on("click",".tab-button a",function(e){var t=$(this).closest(".tab-button"),a=t.closest(".tabs-root"),s=t.data("tabid"),o=$(".tab-"+s,a);return $(".tab-comment",a),$(".tab-comment .ccomment-thread, .tab-comment .pagination-wrapper",a),PubSub.publish("DaGa.track_event",{category:"Deviation",action:"mobile_tab_click",label:s}),e.preventDefault(),"fave"!=s||t.hasClass("loggedin")?(t.hasClass("selected")?o.slideUp("fast",function(){$(this).removeClass("opened"),a.removeClass("open"),t.removeClass("selected")}):(t.siblings(".tab-button").removeClass("selected"),$(".tab-container",a).removeClass("opened").hide(),t.addClass("selected"),o.slideDown("fast",function(){$(this).addClass("opened"),a.addClass("open")})),void 0):($("#overhead #oh-loginbutton").click(),void 0)})}),window.DWait&&DWait.run("jms/mobile/deviation.tabs.js")});
DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/pubsub.js","jms/lib/gmi.js",".domready"],function(){window.Collections=GMIBase.extend({gmiConstructor:function(){this.userid=this.$.data("id"),this.deviationid=this.$.data("deviationid"),this.bind()},bind:function(){var e=this.$.find(".add-new");this.$.on("click",".collection",this.collectionClick.bind(this)),this.$.on("click",".add-new-link",this.toggleAdd.bind(this,!0)),this.$.on("keydown",".collection-name",this.collectionNameKeydown.bind(this)),e.on("click",".cancel-add-collection",this.toggleAdd.bind(this,!1)),e.on("click",".new-collection",this.addCollectionClick.bind(this)),e.on("blur",this.toggleAdd.bind(this,!1))},addToCollection:function(e,t,i){DiFi.pushPost("Deviation","add_favourite_to_folder",[this.deviationid,e],t),DiFi.send(),PubSub.publish("DaGa.track_event",{category:"Collections",action:"add_favourite",label:"source-devmobile_collectionowner-user_collectiontype-"+(i?"default":"collection")})},removeFromCollection:function(e,t,i){DiFi.pushPost("Gallections","remove_resource",[this.userid,RESOURCE_FAVCOLLECTIONS,e,1,this.deviationid],t),DiFi.send(),PubSub.publish("DaGa.track_event",{category:"Collections",action:"remove_favourite",label:"source-devmobile_collectionowner-user_collectiontype-"+(i?"default":"collection")})},createCollection:function(e,t){DiFi.pushPost("Gallections","create",[this.userid,RESOURCE_FAVCOLLECTIONS,e],t),DiFi.send(),PubSub.publish("DaGa.track_event",{category:"Collections",action:"create_collection",label:"source-devmobile_collectionowner-user"})},toggleFavourite:function(e,t){var i=(e?"add":"remove")+"_favourite";DiFi.pushPost("Deviation",i,[this.deviationid],t),DiFi.timer(1),PubSub.publish("DaGa.track_event",{category:"Collections",action:i,label:"source-devmobile_collectionowner-user_collectiontype-default"})},difiError:function(e,t){ddt.log("deviation",t,e),e.content&&e.content.error&&(t=e.content.error+" "+t),alert(t)},collectionClick:function(e){var t=$(e.currentTarget),i=t.data("galleryid"),o=t.data("featured");e.preventDefault(),t.hasClass("added")?this.removeFromCollection(i,this.onUncollected.bind(this,e.currentTarget),o):this.addToCollection(i,this.onCollected.bind(this,e.currentTarget),o)},addCollectionClick:function(e,t){if(e.preventDefault(),t||(t=$(e.currentTarget).siblings(".collection-name").val()),t){var i;this.$.find(".collection").each(function(){return $(this).text().toLowerCase()==t.toLowerCase()?(i=this,!1):void 0}),i?this.addToCollection($(i).data("galleryid"),this.onCollected.bind(this,i)):this.createCollection(t,this.onCollectionCreated.bind(this,t,e))}},toggleAdd:function(e,t){var i=this.$.find(".add-new"),o=this.$.find(".add-new-link"),n=i.find(".collection-name"),l=this;e?($("html").on("click.addCollection",function(e){$target=$(e.target),!$target.parents(".add-new").length>0&&l.toggleAdd(!1)}),n.focus()):($("html").off("click.addCollection"),n.val("")),0!==o.length?(i.toggle(e),o.toggle(!e)):e||n.blur(),t&&(t.preventDefault(),t.stopPropagation())},collectionNameKeydown:function(e){13==e.keyCode&&this.addCollectionClick(e,$(e.currentTarget).val())},onCollected:function(e,t,i){if(t){var o=this.getFaveTab();$(e).addClass("added").removeClass("just-added"),o.addClass("isfav");var n=o.find(".iconx-favesstar").clone().appendTo(o).addClass("flyMe");n.animate({opacity:0,marginTop:"-100px"},700,function(){n.remove()})}else this.difiError(i.response,"Failed to add deviation to collection.")},onUncollected:function(e,t,i){t?($(e).removeClass("added"),0==this.getFaveTab().find(".added").length&&this.toggleFavourite(!1,this.onFaveToggled.bind(this))):this.difiError(i.response,"Failed to remove deviation from collection.")},onFaveToggled:function(e,t){e?this.getFaveTab().removeClass("isfav"):this.difiError(t.response,"Failed to toggle favourite on deviation.")},onCollectionCreated:function(e,t,i,o){if(i){var n=$('<li><a class="collection" href="#"></a></li>'),l=n.find(".collection"),a=o.response.content,d=$(t.currentTarget).parent().parent();l.data("galleryid",a.gallectionid).text(e).addClass("just-added").on("click",this.collectionClick.bind(this)),n.insertBefore($(".favesnav .add-new-link, .favesnav .add-new").first()),this.toggleAdd(!1);var c=d.find(".just-added");this.addToCollection(a.gallectionid,this.onCollected.bind(this,c),!1)}else this.difiError(o.response,"Failed to create new collection.")},getFaveTab:function(){return $(".tab-fave, .fave-tab",this.$.closest(".tabs-root"))}}),window.DWait&&DWait.run("jms/mobile/deviation.favourites.js")});
DWait.ready(["jms/lib/jquery/jquery.current.js",".domready"],function(){DWait.init("MobileComments.init",function(e){var t=$(e);t.find(".talk-tower textarea").attr("placeholder","Add Comment..."),$(".dev-page-view").prepend('<a id="comments"></a>'),("#comments"==window.location.hash||"#critiques"==window.location.hash)&&($(".comment-tab:first").addClass("selected"),$(".tab-comment:first").addClass("opened").removeClass("initial"))}),window.DWait&&DWait.run("jms/mobile/deviation.comments.js")});
DWait.ready(["jms/lib/jquery/jquery.current.js",".domready"],function(){DWait.init("MobileMLT.lazy",function(i){function n(){var n=$(i).find(".tinythumb"),a=$(window).width(),t=9;a>510&&(t=10+2*Math.floor((a-510)/100)),n.slice(0,t).filter(".lazy").each(function(){var i=$(this),n=i.data("src");i.css("background-image",'url("'+n+'")').removeClass("lazy"),i.find("img").prop("src",n)})}n(),$(window).on("orientationchange resize",n)}),window.DWait&&DWait.run("jms/mobile/deviation.lazymlt.js")});
DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/browser.js","jms/lib/jquery/plugins/jquery.transit.js","jms/lib/cookie.js","jms/thirdparty/lib/browser-deeplink.js"],function(){$(function(){var s=function(){if(this.options={title:"DeviantArt",author:"DeviantArt",price:"FREE",inGooglePlay:"In Google Play",GooglePlayParams:null,icon:"//st.deviantart.net/icons/android_app_192.png",button:"VIEW",url:null,scale:"auto",speedIn:300,speedOut:400,daysHidden:9999,appendToSelector:"body"},!this.getHideCookie()){this.scale="auto"==this.options.scale?$(window).width()/window.screen.width:this.options.scale,1>this.scale&&(this.scale=1);var s=$('meta[name="google-play-app"]');0!=s.length&&(this.appId=/app-id=([^\s,]+)/.exec(s.attr("content"))[1],s=$('meta[property="da:appurl"]'),1==s.length&&(this.appUrl=s.attr("content")),PubSub.subscribe([{eventname:"DeviationExtras.loaded",subscriber:this,callback:this.extrasLoaded.bind(this)}]),this.title=this.options.title,this.author=this.options.author,this.create(),this.show(),this.listen())}};s.prototype={constructor:s,create:function(){var s=this.options.icon,t="market://details?id="+this.appId,e=this.options.price+" - "+this.options.inGooglePlay;this.options.GooglePlayParams&&(t+="&referrer="+this.options.GooglePlayParams);var i='<div id="smartbanner" class="android"><div class="sb-container"><a href="#" class="sb-close">&times;</a><span class="sb-icon"></span><div class="sb-info"><strong>'+this.title+"</strong><span>"+this.author+"</span><span>"+e+'</span></div><a href="'+t+'" class="sb-button"><span>'+this.options.button+"</span></a></div></div>";$(this.options.appendToSelector).prepend(i),s?$("#smartbanner .sb-icon").css("background-image",'url("'+s+'")'):$("#smartbanner").addClass("no-icon"),this.bannerHeight=$("#smartbanner").outerHeight()+2,this.scale>1&&($("#smartbanner").css("top",parseFloat($("#smartbanner").css("top"))*this.scale).css("height",parseFloat($("#smartbanner").css("height"))*this.scale).hide(),$("#smartbanner .sb-container").css("-webkit-transform","scale("+this.scale+")").css("-moz-transform","scale("+this.scale+")").css("transform","scale("+this.scale+")").css("width",$(window).width()/this.scale)),$("#smartbanner").css("position","relative")},listen:function(){$("#smartbanner .sb-close").on("click",$.proxy(this.close,this)),$("#smartbanner .sb-button").on("click",$.proxy(this.install,this))},show:function(){var s=$("#smartbanner");s.css({top:-1*this.bannerHeight*this.scale,"margin-bottom":-1*this.bannerHeight*this.scale}).show(),s.stop(),s.transition({top:0,marginBottom:0},this.options.speedIn).addClass("shown"),$("#overhead").addClass("relative")},hide:function(){var s=$("#smartbanner");s.stop(),s.transition({top:-1*this.bannerHeight*this.scale,marginBottom:-1*this.bannerHeight*this.scale}).removeClass("shown"),$("#overhead").removeClass("relative")},close:function(s){s.preventDefault(),this.hide(),this.setHideCookie()},install:function(s){this.hide(),this.setHideCookie(),deeplink.setup({android:{storeUrl:"https://play.google.com/store/apps/details?id="+this.appId,appId:this.appId}}),this.appUrl&&deeplink.open(this.appUrl)&&s.preventDefault()},setHideCookie:function(){var s=new Date;s.setDate(s.getDate()+this.options.daysHidden),window.Cookie.set("sb-closed",1,{expires:s})},getHideCookie:function(){return window.Cookie.get("sb-closed",!1)},extrasLoaded:function(s,t){t&&t.deviationuuid&&(this.appUrl="DeviantArt://deviation/"+t.deviationuuid)}},$.smartbanner=function(){var t=$(window),e=t.data("smartbanner");e||t.data("smartbanner",e=new s)},$.smartbanner.Constructor=s}),$(function(){Browser.isAndroid&&!window.no_smartbanner&&$.smartbanner()}),window.DWait&&DWait.run("jms/mobile/android_smartbanner.js")});
DWait.ready(["jms/lib/ddt.js","jms/lib/jquery/jquery.current.js","jms/lib/jquery/plugins/jquery.throttle-debounce.js","jms/lib/Base.js","jms/lib/difi.js"],function(){(function(){var e=ddt.createLogger("ads.adhesion"),s=Base.extend({$:null,$container:null,paused:0,destroyed:!1,ad:null,scroll_listener_active:!0,scroll_timeout:null,supressed:!1,enabled:!0,page_nsfg:!1,reload_on_duperbrowse:!0,hide_disabled_waiting_for_onload:!0,handlers:{show_ad:function(e,s){return s.suppress?this.suppress():(this.suppressed=!1,this.paused&&this.set_pause(this.paused-1),this.paused||this.show_ad(s),void 0)},show:function(){this.show_chrome()},hide:function(){this.hide_chrome()},enable:function(){this.enabled||(this.enabled=!0,this.reload_iframe())},disable:function(){this.enabled=!1,this.hide_chrome()},destroy:function(){this.get_wrapper("safe").remove(),this.get_wrapper("mature").remove(),this.get_wrapper().show()},duper_open:function(){this.is_disabled()||(this.scroll_listener_active=!1,clearTimeout(this.scroll_timeout),this.scroll_timeout=setTimeout(this.scroll_listener_active_timeout.bind(this),500))},duper_close:function(){this.is_disabled()||(this.scroll_listener_active=!1,clearTimeout(this.scroll_timeout),this.scroll_timeout=setTimeout(this.scroll_listener_active_timeout.bind(this),500),this.reload_iframe())},change:function(){this.show_chrome()},overlayad_shown:function(){this.hide_chrome(),this.scroll_listener_active=!1},overlayad_closed:function(){this.show_chrome(),this.scroll_listener_active=!0}},events:{handle_scroll_start:function(){this.scroll_listener_active===!1||this.is_disabled()||this.hide_chrome()},handle_scroll_end:function(){this.scroll_listener_active===!1||this.is_disabled()||(this.show_chrome(),$(window).scrollTop()+$(window).height()==$(document).height()&&this.hide_chrome())},handle_close:function(){DiFi.pushPost("User","pauseMobileAdhesionAd",[],function(){}),DiFi.send(),this.destroy(),this.hide_chrome(),this.set_pause(4)}},constructor:function(s){this.$=$(s),this.$container=this.$.find(".ads-container"),this.page_nsfg=this.$.hasClass("is_nsfg")?!0:!1,this.enabled=!parseInt(this.$.data("disabled"),10),this.set_pause(parseInt(this.$.data("paused"),10)||0),!this.paused&&this.enabled&&this.sideload_iframe(),deviantART&&deviantART.adblock?(this.paused=!0,this.hide_chrome()):this.bind();var i=this,t=window.googletag||{};t.cmd=t.cmd||[],t.cmd.push(function(){t.pubads().addEventListener("slotOnload",function(s){s.slot&&s.slot.getAdUnitPath&&s.slot.getAdUnitPath().match(/adhesion/)&&setTimeout(function(){e.log("enabling adhesion hiding"),i.hide_disabled_waiting_for_onload=!1},1e3)})})},bind:function(){this.bind_dom(),PubSub.subscribe([{eventname:"AdhesionAd.show_ad",subscriber:this,callback:this.handlers.show_ad},{eventname:"AdhesionAd.show",subscriber:this,callback:this.handlers.show},{eventname:"AdhesionAd.hide",subscriber:this,callback:this.handlers.hide},{eventname:"AdhesionAd.disable",subscriber:this,callback:this.handlers.disable},{eventname:"AdhesionAd.enable",subscriber:this,callback:this.handlers.enable},{eventname:"AdhesionAd.destroy",subscriber:this,callback:this.handlers.destroy},{eventname:"Duperbrowse.opened",subscriber:this,callback:this.handlers.duper_open},{eventname:"Duperbrowse.closed",subscriber:this,callback:this.handlers.duper_close},{eventname:"Minibrowse.next_click",subscriber:this,callback:this.handlers.change},{eventname:"Minibrowse.prev_click",subscriber:this,callback:this.handlers.change},{eventname:"OverlayAd.shown",subscriber:this,callback:this.handlers.overlayad_shown},{eventname:"OverlayAd.closed",subscriber:this,callback:this.handlers.overlayad_closed}])},bind_dom:function(){$(window).on("scroll.adhesion",$.debounce(150,!0,this.events.handle_scroll_start.bind(this))),$(window).on("scroll.adhesion",$.debounce(450,this.events.handle_scroll_end.bind(this))),this.$.find(".close").on("click.adhesion",this.events.handle_close.bind(this))},show_ad:function(s){if(this.paused)return e.log("show_ad paused"),void 0;if(this.is_disabled())return e.log("ad disabled"),void 0;s=s||{};var i=s.adsafe?"safe":"mature";if(e.log("show_ad is "+i,s),"safe"===i?this.$.removeClass("is_nsfg"):this.$.addClass("is_nsfg"),!s.content)return e.log("show_ad no ad content"),this.suppress(),void 0;if(s.content||this.wrapper_exists(i)){this.scroll_listener_active=!0,this.$.find(this.get_wrapper_selector()).removeClass("dp-ad-wrapper-active").hide();var t=this.get_wrapper(i);t.addClass("dp-ad-wrapper-active").show(),this.reload_on_duperbrowse&&0==this.hide_disabled_waiting_for_onload&&t.empty(),s.content&&!t.children().length&&(t.html(s.content),this.sideload_iframe())}this.show_chrome()},sideload_iframe:function(){var e=this.get_active_wrapper().find("iframe[data-src]");e&&(this.hide_disabled_waiting_for_onload=!0,e.attr("src",e.data("src")),e.removeAttr("data-src"))},reload_iframe:function(){var e=this.get_active_wrapper().find(">iframe");e.length&&(e.replaceWith(e.clone()),this.$.toggleClass("is_nsfg",this.page_nsfg),this.sideload_iframe(),this.show_chrome())},show_chrome:function(){if(!this.paused){this.destroyed&&this.reattach(),e.log("Show adhesion");var s=this.$.hasClass("is_nsfg")?100:50;this.$.show().delay(300).css("height",s).find(".close").show()}},hide_chrome:function(){(!this.hide_disabled_waiting_for_onload||this.is_disabled()||this.paused)&&(e.log("Hide adhesion"),this.$.css("height",0).delay(100).hide(1).find(".close").hide())},get_wrapper:function(e){var s=this.get_wrapper_selector(e);return this.wrapper_exists(e)||this.$container.append($("<div>",{"class":s.replace(/\./g," ").trim()})),this.$.find(s)},get_active_wrapper:function(){return this.get_wrapper("dp-ad-wrapper-active")},wrapper_exists:function(e){return this.$.find(this.get_wrapper_selector(e)).length},get_wrapper_selector:function(e){var s=".mobile-ad.dp-ad-wrapper";return e&&(s+="."+e),s},set_pause:function(e){this.paused=e,!e&&this.enabled?this.show_chrome():this.hide_chrome()},is_disabled:function(){return this.suppressed||!this.enabled},destroy:function(){e.log("Detached ad container"),this.ad=this.$container.detach(),this.destroyed=!0,$(window).off(".adhesion")},reattach:function(){e.log("Attach ad container"),this.$.append(this.ad),this.bind_dom(),this.destroyed=!1,this.ad=null},scroll_listener_active_timeout:function(){this.scroll_listener_active=!0,clearTimeout(this.scroll_timeout)},suppress:function(){e.log("Suppressing"),clearTimeout(this.scroll_timeout),this.scroll_listener_active=!1,this.suppressed=!0,this.hide_chrome()}});DWait.init("mobile.adhesion.init",function(i){return window.location!==window.parent.location?($(i).hide(),void 0):(e.log("Start adhesion unit",i),new s(i),void 0)})})(),window.DWait&&DWait.run("jms/mobile/adhesion_ad.js")});
DWait.ready(["jms/lib/ddt.js","jms/lib/jquery/jquery.current.js","cssms/minish/hpto.css","jms/lib/pubsub.js","jms/lib/Base.js"],function(){(function(){var s=Base.extend({$:null,seen:[],handlers:{show_ad:function(s,t){return t.id&&$.inArray(t.id,this.seen)>-1?(this.close(),void 0):(this.seen.push(t.id),this.show_ad(t.ad),void 0)},close:function(){this.close()},destroy:function(){this.stop_autoclose(),this.$.hide()}},events:{handle_close:function(){this.close()}},constructor:function(s){this.$=$(s),this.bind(),"duperbrowse"==this.$.data("context")?this.hide():this.show()},bind:function(){PubSub.subscribe([{eventname:"OverlayAd.show_ad",subscriber:this,callback:this.handlers.show_ad},{eventname:"OverlayAd.destroy",subscriber:this,callback:this.handlers.destroy}]),this.$.on("click.overlayad",".dismiss",this.events.handle_close.bind(this))},unbind:function(){PubSub.unsubscribe([{eventname:"OverlayAd.show_ad",subscriber:this},{eventname:"OverlayAd.destroy",subscriber:this}]),this.$.off("click.overlayad",".dismiss")},show_ad:function(s){s=s||{};var t=s.adsafe?"safe":"mature";if(s.content||this.wrapper_exists(t)){this.$.find(this.get_wrapper_selector()).removeClass("dp-ad-wrapper-active").hide();var e=this.get_wrapper(t);s.content&&!e.children().length&&e.html(s.content),e.addClass("dp-ad-wrapper-active").show()}this.show()},show:function(){PubSub.publish("OverlayAd.shown"),this.$.show()},close:function(){PubSub.publish("OverlayAd.closed");var s=this.get_wrapper();s.empty(),this.hide()},hide:function(){this.$.hide(),this.stop_autoclose()},get_wrapper:function(s){var t=this.get_wrapper_selector(s);return this.wrapper_exists(s)||this.$.append($("<div>",{"class":t.replace(/\./g," ").trim()})),this.$.find(t)},wrapper_exists:function(s){return this.$.find(this.get_wrapper_selector(s)).length},get_wrapper_selector:function(s){var t=".mobile-ad.dp-ad-wrapper";return s&&(t+="."+s),t},stop_autoclose:function(){this.timeout_id&&clearTimeout(this.timeout_id)},start_autoclose:function(){this.stop_autoclose(),this.timeout_id=setTimeout(this.close.bind(this),s.AUTOCLOSE_TIMEOUT)},destroy:function(){this.unbind(),this.$.remove()}},{AUTOCLOSE_TIMEOUT:8e3});DWait.init("mobile.overlayad.init",function(t){ddt.log("ads.overlay","Start OverlayAd unit",t),window.location===window.parent.location&&new s(t)})})(),window.DWait&&DWait.run("jms/mobile/overlay_ad.js")});
(function(n,e){"function"==typeof define&&define.amd?define("deeplink",e(n)):"object"==typeof exports?module.exports=e(n):n.deeplink=e(n)})(window||this,function(n){"use strict";if(n.document&&n.navigator){var e,t={},i={iOS:{},android:{},androidDisabled:!1,fallback:!0,delay:1e3,delta:500},r=function(n,e){var t={};for(var i in n)t[i]=n[i];for(var i in e)t[i]=e[i];return t},a=function(){var n="itms-apps://itunes.apple.com/app/",e=t.iOS.appName,i=t.iOS.appId;return i&&e?n+e+"/id"+i+"?mt=8":null},o=function(){var n="market://details?id=",e=t.android.appId;return e?n+e:null},d=function(){var n={ios:t.iOS.storeUrl||a(),android:t.android.storeUrl||o()};return n[t.platform]},u=function(){return navigator.userAgent.match("Android")},c=function(){return navigator.userAgent.match("iPad")||navigator.userAgent.match("iPhone")||navigator.userAgent.match("iPod")},f=function(){return u()||c()},l=function(n){return function(){var e=d(),i=t.delay+t.delta;"string"==typeof e&&i>Date.now()-n&&(window.location.href=e)}},p=function(n){t=r(i,n),u()&&(t.platform="android"),c()&&(t.platform="ios")},s=function(n){if(!f())return!1;if(!u()||!t.androidDisabled){if(u()&&!navigator.userAgent.match(/Firefox/)){var i=n.match(/([^:]+):\/\/(.+)$/i);n="intent://"+i[2]+"#Intent;scheme="+i[1],n+=";package="+t.android.appId+";end"}t.fallback&&(e=setTimeout(l(Date.now()),t.delay));var r=document.createElement("iframe");return r.onload=function(){clearTimeout(e),r.parentNode.removeChild(r),window.location.href=n},r.src=n,r.setAttribute("style","display:none;"),document.body.appendChild(r),!0}};return{setup:p,open:s}}}),window.DWait&&DWait.run("jms/thirdparty/lib/browser-deeplink.js");if(window.DWait){DWait.count()}