(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{100:function(t,e,n){"use strict";n.d(e,"b",function(){return d}),n.d(e,"a",function(){return u});var a=n(5),i=n(0),o=n(16),r=n.n(o),c=n(52),s=function(t,e){return"".concat(t,":").concat(e)},u=function(t){var e=i.a.get("googleAnalytics.trackers.editorial"),n={play:"metric1",skip:"metric2",25:"metric3",50:"metric4",75:"metric5",end:"metric6"},o=function(t){var e={video:{id:"gu-video-youtube-".concat(t.mediaId),eventType:"video:content:".concat(t.eventType)}};r.a.record(e)};["play","25","50","75","end"].forEach(function(i){a.a.once(s(i,t),function(a){var r={mediaId:t,mediaType:"video",eventType:i,isPreroll:!1};o(r),window.ga("".concat(e,".send"),"event",Object(c.a)(r,n,a,"gu-video-youtube",function(){return"video content"},t))})}),o({mediaId:t,mediaType:"video",eventType:"ready",isPreroll:!1})},d=function(t,e){a.a.emit(s(t,e),e)}},126:function(t,e,n){var a=n(31),i=n(17);t.exports=function(t,e,n){var o=!0,r=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return i(n)&&(o="leading"in n?!!n.leading:o,r="trailing"in n?!!n.trailing:r),a(t,e,{leading:o,maxWait:e,trailing:r})}},135:function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"a",function(){return o});var a=n(51),i=function(t){Object.keys(t).forEach(function(e){a.a.set("".concat("accessibility",".").concat(e),t[e])})},o=function(t){return!0===function(t){return!1!==a.a.get("".concat("accessibility",".").concat(t))}(t)}},139:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var a=n(4),i=n.n(a),o=n(0),r=n(136),c=n(122),s=new Promise(function(t){window.YT&&window.YT.Player?t():window.onYouTubeIframeAPIReady=t}),u=function(t){t&&t.classList.add("youtube__video-started")},d=function(t){return document.getElementById("youtube-".concat(t))},l=function(t,e,n,a){return Object(r.a)("https://www.youtube.com/iframe_api",{}),s.then(function(){return function(t,e,n,a,i,r){var s=!1!==Object(c.b)(c.e),u=!o.a.get("switches.youtubeRelatedVideos");return new window.YT.Player(t,{videoId:e,width:"100%",height:"100%",events:{onReady:a,onStateChange:i,onError:function(t){console.error("YOUTUBE: ".concat(t))}},embedConfig:{relatedChannels:[],disableRelatedVideos:u,adsConfig:{nonPersonalizedAd:!s}}})}(t.id,n,0,function(t){var a=d(n);(function(t){return t.target.getCurrentTime()>0})(t)&&u(a),function(t,e,n){i.a.write(function(){n&&n.classList.add("youtube__video-ready")}),e&&"function"==typeof e.onPlayerReady&&e.onPlayerReady(t)}(t,e,a)},function(t){!function(t,e,n){if(n&&o.a.get("page.isDev")){var a=window.YT.PlayerState,r=Object.keys(a).find(function(e){return a[e]===t.data});r&&console.log("Player ".concat(n.id," is ").concat(r))}i.a.write(function(){["ENDED","PLAYING","PAUSED","BUFFERING","CUED"].forEach(function(e){n&&(n.classList.toggle("youtube__video-".concat(e.toLocaleLowerCase()),t.data===window.YT.PlayerState[e]),u(n))})}),e&&"function"==typeof e.onPlayerStateChange&&e.onPlayerStateChange(t)}(t,e,d(n))})})}},143:function(t,e,n){"use strict";n.d(e,"a",function(){return E}),n.d(e,"b",function(){return S});var a=n(6),i=(n(2),n(7)),o=n(14),r=n(139),c=n(100),s=n(30),u=n(12),d=n(0),l=n(10),f=n(31),h=n.n(f),v=n(135),p=n(28),m={},g=[];document.addEventListener("focusout",function(){g.forEach(function(t){a.a.read(function(){if(document.activeElement===t)return Object(u.a)(".vjs-big-play-button",t.parentElement)}).then(function(t){a.a.write(function(){t&&t.addClass("youtube-play-btn-focussed")})})})}),document.addEventListener("focusin",function(){a.a.read(function(){return Object(u.a)(".vjs-big-play-button")}).then(function(t){a.a.write(function(){t&&t.removeClass("youtube-play-btn-focussed")})})});var b=function(t){m[t].progressTracker&&clearInterval(m[t].progressTracker)},y=function(t,e){var n=e.trackingId,a=e.iframe,i=e.overlay,o=e.endSlate,r=e.paused;b(t),function(t){m[t].progressTracker=setInterval(function(t){var e=m[t];if(e){var n=e.pendingTrackingCalls,a=e.youtubePlayer,i=e.duration,o=e.trackingId;if(n.length){var r=a.getCurrentTime();if(i){var s=Math.round(r/i*100);n.length&&s>=n[0]&&(Object(c.b)(n[0].toString(),o),n.shift())}}}}.bind(null,t),1e3),m[t].progressTracker}(t),r?e.paused=!1:Object(c.b)("play",n);var s=a.closest(".immersive-main-media");if(s&&s.classList.add("atom-playing"),i&&o&&!o.rendered){var u=i.parentElement;u&&o.fetch(u,"html")}},j=function(t){var e=t.split("?");return 1===e.length?"":Object(p.d)(e[1]).v||""},w={ENDED:function(t){var e=m[t];b(t),Object(c.b)("end",e.trackingId),e.pendingTrackingCalls=[25,50,75];var n=e.iframe&&e.iframe.closest(".immersive-main-media")||null;n&&n.classList.remove("atom-playing")},PLAYING:function(t){var e=m[t];if(e){var n=m[t],a=n.youtubePlayer,r=n.youtubeId,s=j(a.getVideoUrl());r!==s?Object(i.a)("/atom/youtube/".concat(s,".json")).then(function(n){var i=n.atomId;i&&(e.trackingId=i,e.youtubeId=s,e.duration=a.getDuration(),Object(c.a)(i),y(t,e))}).catch(function(t){Object(o.a)(Error("Failed to get atom ID for youtube ID ".concat(s,". ").concat(t)),{feature:"youtube"},!1)}):y(t,e)}},PAUSED:function(t){m[t].paused=!0,b(t)}},_=function(){var t=document.querySelector(".immersive-main-media__media .youtube-media-atom"),e=t?t.offsetHeight:0,n=document.querySelector(".immersive-main-media__headline-container"),a=e-(n?n.offsetHeight:0),i=document.querySelector(".youtube-media-atom__immersive-interface");i&&(i.style.top="".concat(a,"px"))},k=function(t,e,n,a,i){var o=document.getElementById(n);if(o){g.push(o);var r=i.target,c=j(r.getVideoUrl()),u=r.getDuration();if(m[e]={iframe:o,trackingId:t,youtubeId:c,duration:u,youtubePlayer:r,paused:!1,pendingTrackingCalls:[25,50,75]},function(t){return("video"===d.a.get("page.contentType","").toLowerCase()&&(d.a.get("page.isDev")?0===document.referrer.indexOf(window.location.origin):0===document.referrer.indexOf(d.a.get("page.host")))&&(m[t].iframe&&!!m[t].iframe.closest('figure[data-component="main video"]')||!1)||d.a.get("page.isFront"))&&!(Object(l.o)()||Object(l.l)())&&Object(v.a)("flashing-elements")}(e)&&i.target.playVideo(),a&&(m[e].overlay=a,d.a.get("page.section")&&!d.a.get("switches.youtubeRelatedVideos")&&Object(l.m)({min:"desktop"}))){var f=function(t){var e=t.parentNode;if(e instanceof HTMLElement){var n=(e.dataset||{}).endSlate;if(n){var a=new s.a;return a.endpoint=n,a}}}(a);f&&(m[e].endSlate=f)}o.closest(".immersive-main-media__media")&&(_(),window.addEventListener("resize",h()(_.bind(null),200)))}},O=function(t){a.a.read(function(){if(t){var e=t.querySelector(".youtube-media-atom__iframe");if(e){var n=e.id,a=t.getAttribute("data-media-atom-id")||"",i="".concat(a,"/").concat(Math.random().toString(36).substr(2,9));t.setAttribute("data-unique-atom-id",i);var o=t.querySelector(".youtube-media-atom__overlay"),s=t.getAttribute("data-channel-id")||"";Object(c.a)(a),Object(r.a)(e,{onPlayerReady:function(t){k(a,i,n,o,t)},onPlayerStateChange:function(t){!function(t,e){var n=e.data,a=Object.keys(w).find(function(t){return n===window.YT.PlayerState[t]});a&&w[a](t)}(i,t)}},e.dataset.assetId,s)}}})},C=function(t){t&&a.a.read(function(){Object(u.a)(".youtube-media-atom:not(.no-player)",t).each(function(t){var e=t.querySelector(".youtube-media-atom__overlay");d.a.get("page.isFront")?e.addEventListener("click",function(){O(t)}):O(t)})})},E=function(t){t&&t.length?t.forEach(C):C(document.body)},S=function(t){var e=m[t];e&&e.youtubePlayer.pauseVideo()}},218:function(t,e,n){var a=n(219),i=n(137);t.exports=function(t,e){return t&&a(t,e,i)}},219:function(t,e,n){var a=n(220)();t.exports=a},220:function(t,e){t.exports=function(t){return function(e,n,a){for(var i=-1,o=Object(e),r=a(e),c=r.length;c--;){var s=r[t?c:++i];if(!1===n(o[s],s,o))break}return e}}},330:function(t,e,n){"use strict";n.d(e,"a",function(){return h});var a=n(2),i=n.n(a),o=n(31),r=n.n(o),c=n(6),s=n(5),u=[],d={top:0,bottom:0},l=function t(){d.top=window.pageYOffset,d.bottom=d.top+i.a.viewport().height,0===(u=u.filter(function(t){return!t.conditionFn()||(t.loadFn(),!1)})).length&&s.a.off("window:throttledScroll",t)},f=r()(l,2e3),h=function(t,e,n){c.a.read(function(){var a=i()(t);!function(t,e){var n={conditionFn:t,loadFn:e};u.push(n),1===u.length&&s.a.on("window:throttledScroll",l),f()}(function(){var t=a.offset(),n=t.top-e,i=t.top+t.height+e;return d.top>n&&d.bottom<i},n)})}},360:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var a=n(4),i=n.n(a),o=n(135),r=function(t){Object(o.a)("flashing-elements")?t&&t():i.a.write(function(){document.body&&document.body.classList.add("disable-flashing-elements"),t&&t()})}},510:function(t,e){t.exports='<div class="stocks__stock-value <%=deltaClass%>">\n    <div class="stocks__divider"></div>\n    <div class="stocks__name"><%=name%><%=closedInline%></div>\n    <div class="stocks__value">\n        <div class="stocks__price"><%=price%></div>\n        <%=marketDownIcon%>\n        <%=marketUpIcon%>\n        <%=marketSameIcon%>\n        <div class="stocks__change"><%=change%></div>\n    </div>\n    <%=closed%>\n</div>\n'},511:function(t,e){t.exports='<div class="stocks__stocks-container">\n    <%=stocks%>\n</div>\n'},512:function(t,e,n){var a=n(146),i=n(513),o=Object.prototype.hasOwnProperty,r=i(function(t,e,n){o.call(t,n)?t[n].push(e):a(t,n,[e])});t.exports=r},513:function(t,e,n){var a=n(514),i=n(515),o=n(318),r=n(116);t.exports=function(t,e){return function(n,c){var s=r(n)?a:i,u=e?e():{};return s(n,t,o(c,2),u)}}},514:function(t,e){t.exports=function(t,e,n,a){for(var i=-1,o=null==t?0:t.length;++i<o;){var r=t[i];e(a,r,n(r),t)}return a}},515:function(t,e,n){var a=n(516);t.exports=function(t,e,n,i){return a(t,function(t,a,o){e(i,t,n(t),o)}),i}},516:function(t,e,n){var a=n(218),i=n(517)(a);t.exports=i},517:function(t,e,n){var a=n(125);t.exports=function(t,e){return function(n,i){if(null==n)return n;if(!a(n))return t(n,i);for(var o=n.length,r=e?o:-1,c=Object(n);(e?r--:++r<o)&&!1!==i(c[r],r,c););return n}}},518:function(t,e){t.exports=function(t){return void 0===t}},519:function(t,e){t.exports='<a href="<%=href%>" class="fc-item__liveblog-block" data-link-name="block | <%=index%>" aria-hidden="<%=ariaHidden%>">\n    <div class="fc-item__liveblog-block__text">\n        <div class="fc-item__liveblog-block__time"><%=relativeTime%></div>\n        <%=text%>\n    </div>\n</a>\n'},52:function(t,e,n){"use strict";n.d(e,"a",function(){return a}),n.d(e,"b",function(){return i});var a=function(t,e,n,a,i,o){var r=a,c={eventCategory:"media",eventAction:i(t),eventLabel:n,dimension19:o,dimension20:r},s=e[t.eventType];return s&&(c[s]=1),c},i=function(t){var e="".concat(t.mediaType," ");return t.isPreroll?e+="preroll":e+="content",e}},520:function(t,e,n){var a=n(140),i=n(394),o=n(328),r=n(315),c=a(function(t,e){var n=r(e,o(c));return i(t,32,void 0,e,n)});c.placeholder={},t.exports=c},521:function(t,e){t.exports='<section class="flagship-audio__contributions-banner fc-container">\n    <div class="fc-container__inner">\n        <div class="fc-container__header"> </div>\n        <div class="fc-container--rolled-up-hide fc-container__body flagship-audio__contributions-banner-holder">\n            <div class="flagship-audio__contributions-banner-text">\n                <h2>Support The Guardian</h2>\n                <p>Help us deliver the independent\n                    <br> journalism the world needs</p>\n                <a class="contributions__contribute contributions__option-button"\n                   data-link-name="audio-series-contributions"\n                   href="<%= supportContributeURL %>?acquisitionData=%7B%22componentType%22%3A%22ACQUISITIONS_OTHER%22%2C%22source%22%3A%22GUARDIAN_WEB%22%2C%22campaignCode%22%3A%22today_in_focus%22%2C%22componentId%22%3A%22audio_series_page%22%7D&INTCMP=today_in_focus">\n                    Support The Guardian\n                </a>\n            </div>\n            <div class="flagship-audio__contributions-banner-image">\n                <svg xmlns="http://www.w3.org/2000/svg" width="300" height="107"><path d="M0 83.118h12.148v23.824H0zm16.901-36h12.148v59.824H16.901zm16.902-21.177h12.148v81H33.803zm16.901 21.177h12.148v59.824H50.704zM67.606 18h12.148v88.941H67.606zm16.901 41.824h12.148v47.118H84.507zm16.901-12.706h12.148v59.824h-12.148zm16.902-8.471h12.148v68.294H118.31zM135.211 0h12.148v106.941h-12.148zm16.902 49.765h12.148v57.176h-12.148zm16.901-28.059h12.148v85.235h-12.148zm16.901 8.47h12.148v76.765h-12.148zM202.817 0h12.148v106.941h-12.148zm16.901 47.118h12.148v59.824h-12.148zm16.902-21.177h12.148v81H236.62zm16.901-17.47h12.148v98.471h-12.148zm16.902 41.294h12.148v57.176h-12.148zm16.901 33.882h12.148v23.294h-12.148z" fill="#FF6A56"/></svg>\n            </div>\n        </div>\n    </div>\n</section>\n'},632:function(t,e,n){"use strict";n.r(e);var a=n(12),i=n(0),o=n(10),r=n(5),c=n(121),s=n(360),u=n(7),d=n(14),l=n(134),f=n.n(l),h=n(138),v=n(510),p=n.n(v),m=n(511),g=n.n(m),b=function(){var t=Object(a.a)(".js-container--first .js-container__header");-1!==["uk/business","us/business","au/business"].indexOf(i.a.get("page.pageId"))&&t&&Object(u.a)("/business-data/stocks.json",{mode:"cors"}).catch(function(t){Object(d.a)(t,{feature:"stocks"})}).then(function(e){e&&e.stocks&&e.stocks.length>0&&t.append(function(t){var e=t.stocks.map(function(t){return f()(p.a)({name:t.name,deltaClass:"stocks__stock-value--".concat(t.trend),price:t.price,change:(e=t.change,e>0?"+".concat(e):"".concat(e)),closed:t.closed?'<div class="stocks__closed">closed</div>':"",closedInline:t.closed?'<div class="stocks__closed--inline">closed</div>':"",marketDownIcon:Object(h.a)("marketDownIcon",["stocks__icon","stocks__icon--down"]),marketUpIcon:Object(h.a)("marketUpIcon",["stocks__icon","stocks__icon--up"]),marketSameIcon:Object(h.a)("marketSameIcon",["stocks__icon","stocks__icon--same"])});var e}).join("");return f()(g.a)({stocks:e})}(e))})},y=n(9),j=n.n(y),w=n(15),_=n.n(w),k=n(49),O=n.n(k),C=n(48),E=n.n(C),S=n(50),x=n.n(S),T=n(27),I=n.n(T),L=n(1),$=n.n(L),A=n(18),D=n.n(A),P=n(303),M=function(t){Object(a.a)(".js-tabs-content",t).addClass("tabs__content--no-border"),Object(a.a)(".js-tabs",t).addClass("u-h")},N=function(t){function e(){var t;return j()(this,e),t=O()(this,E()(e).call(this)),$()(I()(I()(t)),"isNetworkFront",void 0),$()(I()(I()(t)),"isVideoFront",void 0),$()(I()(I()(t)),"isInternational",void 0),$()(I()(I()(t)),"parent",void 0),Object(P.a)("most-popular"),t.endpoint="/most-read-geo.json",t.isNetworkFront="Network Front"===i.a.get("page.contentType"),t.isVideoFront="video"===i.a.get("page.pageId"),t.isInternational="international"===i.a.get("page.pageId"),t.manipulationType="html",t}return x()(e,t),_()(e,[{key:"prerender",value:function(){this.elem=D()(".headline-list",this.elem)[0]}},{key:"go",value:function(){var t=this.isNetworkFront?".js-tab-1":".js-tab-2";if(this.parent=D()(".js-popular-trails")[0],this.parent)if(this.isInternational&&this.isNetworkFront||this.isVideoFront)M(this.parent);else{var e=this.parent.querySelector(t);e&&this.fetch(e,"html")}}},{key:"ready",value:function(){this.isNetworkFront&&M(this.parent),Object(P.b)("most-popular"),r.a.emit("modules:geomostpopular:ready")}}]),e}(n(30).a),F=n(2),z=n.n(F),U=n(4),R=n.n(U),q=n(51),V="container-states",H={hidden:"Show",displayed:"Hide"},W=function(t){var e=t.text,n=t.dataLink;return'\n    <button class="fc-container__toggle" data-link-name="'.concat(n,'">\n        <span class="fc-container__toggle__text">').concat(e,"</span>\n    </button>\n")},Q=function(){function t(e){j()(this,t),$()(this,"$container",void 0),$()(this,"state",void 0),$()(this,"$button",void 0),this.$container=z()(e),this.$button=z()(z.a.create(W({text:"Hide",dataLink:"Show"}))),this.state="displayed"}return _()(t,[{key:"buttonText",value:function(){return Object(a.a)(".fc-container__toggle__text",this.$button)}},{key:"updatePref",value:function(t){var e=q.a.get(V),n=t;"displayed"===this.state?delete e[n]:(e||(e={}),e[n]="closed"),q.a.set(V,e)}},{key:"setState",value:function(t){var e=this;this.state=t,R.a.write(function(){e.$container["displayed"===e.state?"removeClass":"addClass"]("fc-container--rolled-up"),e.$button.attr("data-link-name",H["displayed"===e.state?"hidden":"displayed"]),e.buttonText().text(H[e.state])})}},{key:"readPrefs",value:function(t){var e=q.a.get(V);e&&e[t]&&this.setState("hidden")}},{key:"addToggle",value:function(){var t=this,e=this.$container.attr("data-id"),n=Object(a.a)(".js-container__header",this.$container[0]);R.a.write(function(){n.append(t.$button),t.$container.removeClass("js-container--toggle").removeClass("fc-container--will-have-toggle").addClass("fc-container--has-toggle"),t.readPrefs(e)}),r.a.on("module:clickstream:click",function(n){n.target===t.$button[0]&&(t.setState("displayed"===t.state?"hidden":"displayed"),t.updatePref(e))})}}]),t}(),Y=n(512),B=n.n(Y),G=n(104),J="js-button-text",X=Object.freeze({displayed:"displayed",loading:"loading",hidden:"hidden"}),K=function(t){var e=q.a.get("section-states",{type:"session"});return e&&e[t]?X.displayed:X.hidden},Z=function(t,e){var n=q.a.get("section-states",{type:"session"})||{};e!==X.displayed?delete n[t]:n[t]="more",q.a.set("section-states",n,{type:"session"})},tt=function(t,e){var n=function(t){return B()(D()(".js-fc-item",t),function(t){return z()(t).attr("data-id")})}(t),i=z.a.create(e);return Object(a.a)(".js-fc-item",i).each(function(t){var e=z()(t),a=e.attr("class");(e.attr("data-id")in n||Object(G.d)()&&a&&a.includes("paid-content"))&&e.remove()}),i},et=function(){function t(e,n){j()(this,t),$()(this,"id",void 0),$()(this,"state",void 0),$()(this,"isLoaded",void 0),$()(this,"$el",void 0),$()(this,"$container",void 0),$()(this,"$iconEl",void 0),$()(this,"$placeholder",void 0),$()(this,"$textEl",void 0),$()(this,"$errorMessage",void 0),$()(this,"messages",void 0),this.id=n.attr("data-id"),this.state=K(this.id),this.$el=e,this.$container=n,this.isLoaded=!1,this.$iconEl=Object(a.a)(".i",this.$el),this.$placeholder=Object(a.a)(".js-show-more-placeholder",this.$container),this.$textEl=Object(a.a)(".".concat(J),this.$el),this.state===X.displayed&&this.loadShowMoreForContainer(),this.messages=new Map([[X.hidden,Object(a.a)(".js-button-text",this.$el).text()],[X.displayed,"Less"],[X.loading,"Loading&hellip;"]])}return _()(t,[{key:"setState",value:function(t){this.$textEl.html(this.messages.get(t)),this.$el.attr("data-link-name",t===X.displayed?"less":"more").toggleClass("button--primary",t!==X.displayed).toggleClass("button--tertiary",t===X.displayed).toggleClass("collection__show-more--loading",t===X.loading),this.$container.toggleClass("fc-show-more--hidden",t!==X.displayed).toggleClass("fc-show-more--visible",t===X.displayed),this.state=t}},{key:"loadShowMoreForContainer",value:function(){var t,e,n,a=this;R.a.write(function(){a.setState(X.loading)}),(t=i.a.get("page.pageId"),e=this.id,n="/".concat(t,"/show-more/").concat(e,".json"),function(t,e){return Promise.race([e,new Promise(function(e,n){setTimeout(function(){return n(new Error("Timeout"))},t)})])}(5e3,Object(u.a)(n,{mode:"cors"}))).then(function(t){var e,n=t.html.trim();n&&(e=tt(a.$container,n)),R.a.write(function(){e&&a.$placeholder.replaceWith(e),a.setState(X.displayed),Z(a.id,a.state),r.a.emit("modules:show-more:loaded")}),a.isLoaded=!0}).catch(function(t){R.a.write(function(){a.setState(X.hidden)}),a.showErrorMessage(),Object(d.a)(t,{feature:"container-show-more"},!1)})}},{key:"hideErrorMessage",value:function(){var t=this;R.a.write(function(){null!=t.$errorMessage&&t.$errorMessage.addClass("show-more__error-message--invisible")})}},{key:"showErrorMessage",value:function(){var t=this;this.$errorMessage&&this.$errorMessage.remove(),this.$errorMessage=z()(z.a.create('<div class="show-more__error-message">Sorry, failed to load more stories. Please try again.</div>')),R.a.write(function(){null!=t.$errorMessage&&(t.$errorMessage.insertAfter(t.$el),setTimeout(function(){t.hideErrorMessage()},5e3))})}}]),t}(),nt=function(t){R.a.write(function(){t.$container.addClass("fc-show-more--hidden").removeClass("js-container--fc-show-more").toggleClass("fc-show-more--hidden",t.state===X.hidden),t.setState(t.state)})},at=function(){R.a.read(function(){var t=D()(".js-container--fc-show-more").map(z.a).map(function(t){var e=Object(a.a)(".js-show-more-button",t);return e?new et(e,t):null}).filter(function(t){return null!=t});t.forEach(nt),r.a.on("module:clickstream:click",function(e){var n,a=t.find(function(t){return t.$el[0]===e.target});a&&a.state!==X.loading&&(a.isLoaded?(n=a,R.a.write(function(){n.setState(n.state===X.hidden?X.displayed:X.hidden),Z(n.id,n.state)})):(a.$errorMessage&&a.$errorMessage.hide(),a.loadShowMoreForContainer()))})})},it=n(126),ot=n.n(it),rt=Object(o.g)().height,ct=function(t){t.classList.remove("fc-container--lazy-load")},st=function(){var t=D()(".js-container--lazy-load"),e=ot()(function(){0===t.length?r.a.off("window:throttledScroll",e):R.a.read(function(){var e=t.reduce(function(t,e){return t[function(t){var e=t.nextElementSibling,n=e?e.getBoundingClientRect().top:0;return-rt<n&&n<2*rt}(e)?"in":"out"].push(e),t},{in:[],out:[]});t=e.out,R.a.write(function(){e.in.forEach(ct)})})},500);r.a.on("window:throttledScroll",e),e()},ut=n(301),dt=n(6),lt=n(8),ft=n(518),ht=n.n(ft),vt=n(31),pt=n.n(vt),mt=n(519),gt=n.n(mt),bt=30,yt=5,jt=Object(o.g)().height,wt=function(t,e){return dt.a.read(function(){return t.getBoundingClientRect().top}).then(function(n){return n>0&&n<jt&&(setTimeout(function(){var e=z()(t);dt.a.write(function(){e.removeClass("fc-item__liveblog-blocks__inner--offset")})},e?0:2e3),!0)})},_t=function(t,e,n,a){var i=ht()(a);e.forEach(function(e){var o=!1,c=["fc-item__liveblog-blocks__inner","u-faux-block-link__promote"],s=n.slice(0,2).map(function(e,n){return!o&&(e.publishedDateTime>a||i)&&(e.isNew=!0,o=!0,c.push("fc-item__liveblog-blocks__inner--offset")),function(t,e,n){var a=function(t){var e=(t||{}).publishedDateTime;return!!e&&Object(ut.c)(new Date(e))||""}(e);return a=a.match(/yesterday/i)?a.toLowerCase():a?"Latest update ".concat(a," ago"):"Updated just now",f()(gt.a)({ariaHidden:!e.isNew,href:"/".concat(t,"#").concat(e.id),relativeTime:a,text:[e.title,e.body.slice(0,500)].filter(function(t){return null!=t}).join(". "),index:n+1})}(t,e,n)}).slice(0,o?2:1),u=z.a.create('<div class="'.concat(c.join(" "),'">').concat(s.join(""),"</div>")),d=z()(e);dt.a.write(function(){d.empty().append(u)}).then(function(){var t;o&&(t=u[0],wt(t).then(function(e){var n;e||(n=pt()(function(){wt(t,!0).then(function(t){t&&r.a.off("window:throttledScroll",n)})},500),r.a.on("window:throttledScroll",n))}))})})},kt=n(11),Ot=n.n(kt),Ct=n(45),Et=n(330),St=n(292),xt=["document","fragment","json.html"],Tt=[],It=n.n(St)()(function(){Ot.a.on(window,"message",function(t){var e,n=Tt.find(function(e){return e.contentWindow===t.source});n&&"set-height"===(e=JSON.parse(t.data)).type&&z()(n).parent().css("height",e.value)})}),Lt=function(t){!function(t,e){var n,a=z()(t),i=[{width:0,name:"tiny"},{width:180,name:"mini"},{width:220,name:"small"},{width:300,name:"medium"},{width:700,name:"large"},{width:940,name:"huge"}];R.a.read(function(){n=t.offsetWidth}),R.a.write(function(){i.map(function(t,a,i){var o=n>=t.width&&(!i[a+1]||n<i[a+1].width);return t.action=o?"addClass":!!e&&"removeClass",t}).filter(function(t){return t.action}).forEach(function(t){a[t.action]("facia-snap-point--"+t.name)})})}(t,arguments.length>1&&void 0!==arguments[1]&&arguments[1]),Object(a.a)(t).hasClass("facia-snap--football")&&function(t){if(t&&"mobile"!==Object(o.d)()){var e=z()(t);e.css("height",e.parent().css("height"))}}(t)},$t=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.getAttribute("data-snap-uri");n&&Object(Ct.a)(n,{mode:"cors"}).then(function(t){return t.ok?e?t.json().then(function(t){return t.html}):t.text():Promise.reject(new Error("Fetch error: ".concat(t.statusText)))}).then(function(e){a.a.create(e).each(function(e){R.a.write(function(){z()(t).html(e)})}),Object(ut.a)(t)}).catch(function(t){Object(d.a)(t,{feature:"snaps"})})},At=function(t){Object(Et.a)(t,1500,function(){switch(R.a.write(function(){z()(t).addClass("facia-snap-embed")}),Lt(t),t.getAttribute("data-snap-type")){case"document":!function(t){var e=z()(t).offset(),n=Math.ceil((e.width||0)/2),a=t.getAttribute("data-snap-uri")||"",i=Math.min(Math.max(e.height||0,n),400),o=z.a.create('<div style="width: 100%; height: '.concat(i,'px; overflow: hidden; -webkit-overflow-scrolling:touch"></div>'))[0],r=z.a.create('<iframe src="'.concat(a,'" style="width: 100%; height: 100%; border: none;"></iframe>'))[0];z()(o).append(r),Tt.push(r),It(),R.a.write(function(){z()(t).empty().append(o)})}(t);break;case"fragment":$t(t);break;case"json.html":$t(t,!0)}o.o||r.a.on("window:throttledResize",function(){Lt(t,!0)})})},Dt=function(t){Lt(t),o.o||r.a.on("window:throttledResize",function(){Lt(t,!0)})},Pt=function(){Array.from(document.querySelectorAll(".facia-snap-embed")).forEach(Dt),Array.from(document.querySelectorAll(".js-snappable.js-snap")).filter(function(t){var e=Object(a.a)(t).hasClass("facia-snap-embed"),n=t.getAttribute("data-snap-type");return!e&&n&&xt.indexOf(n)>-1}).filter(function(t){return t.getAttribute("data-snap-uri")}).forEach(At)},Mt={13:"enter",38:"up",40:"down",27:"escape"},Nt=function(){function t(e){j()(this,t),$()(this,"apiUrl",void 0),$()(this,"$list",void 0),$()(this,"$input",void 0),$()(this,"oldQuery",void 0),$()(this,"newQuery",void 0),$()(this,"inputTmp",void 0);var n=e.container;this.apiUrl=e.apiUrl,this.bindElements(n),this.bindEvents(),this.oldQuery="",this.newQuery="",this.inputTmp=""}return _()(t,[{key:"bindElements",value:function(t){this.$list=Object(a.a)(".js-search-tool-list",t),this.$input=Object(a.a)(".js-search-tool-input",t)}},{key:"bindEvents",value:function(){Ot.a.on(document.body,"keyup",this.handleKeyEvents.bind(this)),Ot.a.on(document.body,"click",this.handleClick.bind(this)),r.a.on("autocomplete:toggle",this.toggleControls.bind(this))}},{key:"hasInputValueChanged",value:function(){return this.oldQuery.length!==this.newQuery.length}},{key:"handleClick",value:function(e){var n=Object(a.a)(e.target).hasClass("js-search-tool-input"),i=t.nearestLinkNode(e.target);n?(e.preventDefault(),r.a.emit("autocomplete:toggle",!0)):i?(e.preventDefault(),Object(a.a)(".active",this.$list).removeClass("active"),Object(a.a)(i).addClass("active"),this.pushData()):r.a.emit("autocomplete:toggle",!1)}},{key:"toggleControls",value:function(t){var e=Object(a.a)(".js-search-tool-input")[0],n=Object(a.a)(".js-search-tool"),i=Object(a.a)(".js-close-location");t?(this.inputTmp=e.value,n.addClass("is-editing"),e.setSelectionRange(0,e.value.length),i.removeClass("u-h")):(n.removeClass("is-editing"),this.clear(),this.setInputValue(this.inputTmp),i.addClass("u-h"))}},{key:"pushData",value:function(){var t=Object(a.a)(".active",this.$list),e="set";if(0===t.length){if(""!==this.$input.val())return;e="remove"}var n={id:t.attr("data-weather-id"),city:t.attr("data-weather-city"),store:e};r.a.emit("autocomplete:fetch",n),this.setInputValue(),this.inputTmp=n.city,this.$input.blur(),setTimeout(this.destroy.bind(this),50)}},{key:"getListOfResults",value:function(t){if(this.newQuery=t.target.value,!t.target.value.match(/\S/))return this.clear(),void(this.oldQuery="");this.hasInputValueChanged()&&this.fetchData()}},{key:"fetchData",value:function(){var t=this;return Object(u.a)("".concat(this.apiUrl).concat(this.newQuery),{mode:"cors"}).then(function(e){t.renderList(e,5),t.oldQuery=t.newQuery}).catch(function(t){Object(d.a)(t,{feature:"search-tool"})})}},{key:"handleKeyEvents",value:function(t){var e=Mt[t.which||t.keyCode];Object(a.a)(t.target).hasClass("js-search-tool-input")&&("down"===e?(t.preventDefault(),this.move(1)):"up"===e?(t.preventDefault(),this.move(-1)):"enter"===e?this.pushData():"escape"===e?this.toggleControls():this.getListOfResults(t))}},{key:"move",value:function(t){var e=Object(a.a)(".active",this.$list),n=parseInt(e.attr("id"),10);Number.isNaN(n)&&(n=-1),e.removeClass("active"),this.getNewId(n+t)<0?this.setInputValue(this.oldQuery):(Object(a.a)("#".concat(this.getNewId(n+t),"sti"),this.$list).addClass("active"),this.setInputValue())}},{key:"getNewId",value:function(t){var e=Object(a.a)("li",this.$list).length,n=t%e;return n<-1?n=e-1:t===e&&(n=-1),n}},{key:"setInputValue",value:function(t){var e=t||Object(a.a)(".active",this.$list).attr("data-weather-city");this.$input.val(e)}},{key:"renderList",value:function(t,e){var n=document.createDocumentFragment();t.slice(0,e).forEach(function(t,e){var a=document.createElement("li");a.className="search-tool__item",a.innerHTML='<a role="button" href="#'.concat(t.id,'"')+' id="'.concat(e,'sti" class="js-search-tool-link search-tool__link').concat(0===e?' active"':'"',' data-link-name="weather-search-tool" data-weather-id="').concat(t.id,'" data-weather-city="').concat(t.city,'">').concat(t.city,' <span class="search-tool__meta">').concat(t.country,"</span></a>"),n.appendChild(a)}),this.clear().append(n)}},{key:"clear",value:function(){return this.$list.html("")}},{key:"destroy",value:function(){this.clear()}}],[{key:"nearestLinkNode",value:function(t){return Object(a.a)(t).hasClass("js-search-tool-link")?t:a.a.ancestor(t,"js-search-tool-link")}}]),t}(),Ft=null,zt=null,Ut=!1,Rt={init:function(){if(!i.a.get("switches.weather",!1)||!["uk","us","au","international"].includes(i.a.get("page.pageId")))return!1;this.getDefaultLocation()},getUserLocation:function(){var t=q.a.get("weather-location");if(t&&t.id)return t},getWeatherData:function(t){return Object(u.a)(t,{mode:"cors"})},saveUserLocation:function(t){q.a.set("weather-location",{id:t.id,city:t.city})},getDefaultLocation:function(){var t=this,e=this.getUserLocation();return e?this.fetchWeatherData(e):this.getWeatherData("".concat(i.a.get("page.weatherapiurl"),".json")).then(function(e){t.fetchWeatherData(e)}).catch(function(t){Object(d.a)(t,{feature:"weather"})})},fetchWeatherData:function(t){var e=this,n=i.a.get("page.weatherapiurl"),a=i.a.get("page.edition");return this.getWeatherData("".concat(n,"/").concat(t.id,".json?_edition=").concat(a.toLowerCase())).then(function(n){e.render(n,t.city),e.fetchForecastData(t)}).catch(function(t){Object(d.a)(t,{feature:"weather"})})},clearLocation:function(){q.a.remove("weather-location"),null!==zt&&zt.setInputValue()},fetchForecastData:function(t){var e=this;return this.getWeatherData("".concat(i.a.get("page.forecastsapiurl"),"/").concat(t.id,".json?_edition=").concat(i.a.get("page.edition").toLowerCase())).then(function(t){e.renderForecast(t)}).catch(function(t){Object(d.a)(t,{feature:"weather"})})},saveDeleteLocalStorage:function(t){var e=this;"set"===t.store?(this.saveUserLocation(t),this.fetchWeatherData(t).then(function(){return e.toggleForecast()})):"remove"===t.store&&(this.clearLocation(),this.getDefaultLocation())},bindEvents:function(){var t=this;Ot.a.on(document.body,"click",".js-toggle-forecast",function(e){e.preventDefault(),t.toggleForecast()}),r.a.on("autocomplete:fetch",this.saveDeleteLocalStorage.bind(this))},toggleForecast:function(){Object(a.a)(".weather").toggleClass("is-expanded")},addSearch:function(){zt=new Nt({container:Object(a.a)(".js-search-tool"),apiUrl:i.a.get("page.locationapiurl")})},render:function(t,e){this.attachToDOM(t.html,e),Ut||(this.bindEvents(),Ut=!0),null===zt?this.addSearch():zt.bindElements(Object(a.a)(".js-search-tool"))},attachToDOM:function(t,e){Ft=Object(a.a)("#headlines .js-container__header"),Object(a.a)(".js-weather",Ft).remove(),Ft.append(t.replace(new RegExp("<%=city%>","g"),e))},renderForecast:function(t){var e=Object(a.a)(".js-weather-forecast"),n=t.html;e.empty().html(n)}},qt=n(520),Vt=n.n(qt),Ht=n(101),Wt=n(143),Qt=function(t){if(null!=t){var e=t.querySelector(".youtube-media-atom");if(e){var n=e.getAttribute("data-unique-atom-id");if(n)return Object(Wt.b)(n)}}},Yt=function(t,e){return{position:t,atStart:0===t,atEnd:t>=e}},Bt={NEXT:function(t){var e=t.position>=t.length?t.position:t.position+1;return Qt(document.querySelector(".js-video-playlist-item-".concat(e-1))),Object.assign({},t,Yt(e,t.length))},PREV:function(t){var e=t.position<=0?0:t.position-1;return Qt(document.querySelector(".js-video-playlist-item-".concat(e+1))),Object.assign({},t,Yt(e,t.length))},INIT:function(t){var e;return e=t,Object(o.m)({max:"desktop"})&&(Array.from(e.container.querySelectorAll(".youtube-media-atom iframe")).forEach(function(t){t.remove()}),Array.from(e.container.querySelectorAll(".video-container-overlay-link")).forEach(function(t){t.classList.add("u-faux-block-link__overlay"),t.removeAttribute("tabindex"),t.removeAttribute("aria-hidden")}),Array.from(e.container.querySelectorAll(".youtube-media-atom")).forEach(function(t){t.classList.add("no-player")})),dt.a.read(function(){Object(a.a)(".js-video-playlist-image",t.container).each(function(e){Object(Ht.a)(e,Object(a.a)(".js-video-playlist-inner",t.container).get(0),{left:410}).on("firstview",function(t){dt.a.write(function(){var e=t.getAttribute("data-src"),n=t.getAttribute("src");e&&!n&&dt.a.write(function(){t.setAttribute("src",e)})})})})}),t}},Gt=function(t,e){return Bt[e.type]?Bt[e.type](t):t},Jt=function(t){var e=function(t){return{position:0,length:Number(t.getAttribute("data-number-of-videos")),videoWidth:700,container:t}}(t),n=function(t,e){var n=e,a=[],i=function(e){n=t(n,e),a.forEach(function(t){t()})};return i({type:"INIT"}),{dispatch:i,subscribe:function(t){a.push(t)},getState:function(){return n}}}(Gt,e);!function(t,e){Ot.a.on(e,"click",".js-video-playlist-next",function(){t({type:"NEXT"})}),Ot.a.on(e,"keypress",".js-video-playlist-next",function(e){" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),t({type:"NEXT"}))}),Ot.a.on(e,"click",".js-video-playlist-prev",function(){t({type:"PREV"})}),Ot.a.on(e,"keypress",".js-video-playlist-prev",function(e){" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),t({type:"PREV"}))})}(n.dispatch,t),n.subscribe(function(){!function(t,e){var n=-t.videoWidth*t.position;dt.a.write(function(){var i=e.querySelector(".video-playlist__item--active");null!=i&&(i.classList.remove("video-playlist__item--active"),Object(a.a)(".youtube-media-atom__iframe",i).hide(),Object(a.a)(".video-overlay .fc-item__link",i).attr("tabindex","-1"),Object(a.a)(".video-overlay .fc-item__link",i).attr("aria-hidden","true"));var o=e.querySelector(".js-video-playlist-item-".concat(t.position));null!=o&&(o.classList.add("video-playlist__item--active"),Object(a.a)(".youtube-media-atom__iframe",o).show(),Object(a.a)(".video-overlay .fc-item__link",o).removeAttr("tabindex"),Object(a.a)(".video-overlay .fc-item__link",o).removeAttr("aria-hidden")),e.classList.remove("video-playlist--end","video-playlist--start"),t.atStart?(e.classList.add("video-playlist--start"),Object(a.a)(".video-title__link",e).removeAttr("tabindex"),Object(a.a)(".video-title__link",e).removeAttr("aria-hidden"),Object(a.a)(".treats__treat",e).removeAttr("tabindex"),Object(a.a)(".treats__treat",e).removeAttr("aria-hidden"),Object(a.a)(".js-video-playlist-prev",e).attr("aria-hidden","true"),Object(a.a)(".js-video-playlist-prev",e).attr("tabindex","-1")):(Object(a.a)(".video-title__link",e).attr("tabindex","-1"),Object(a.a)(".video-title__link",e).attr("aria-hidden","true"),Object(a.a)(".treats__treat",e).attr("tabindex","-1"),Object(a.a)(".treats__treat",e).attr("aria-hidden","true"),Object(a.a)(".js-video-playlist-prev",e).removeAttr("aria-hidden"),Object(a.a)(".js-video-playlist-prev",e).attr("tabindex","0")),t.atEnd?(e.classList.add("video-playlist--end"),Object(a.a)(".js-video-playlist-next",e).attr("aria-hidden","true"),Object(a.a)(".js-video-playlist-next",e).attr("tabindex","-1")):(Object(a.a)(".js-video-playlist-next",e).removeAttr("aria-hidden"),Object(a.a)(".js-video-playlist-next",e).attr("tabindex","0")),function(t,e){Object(a.a)(".js-video-playlist-image--".concat(e),t).each(function(t){dt.a.read(function(){var e=t.getAttribute("data-src"),n=t.getAttribute("src");return e&&!n?e:null}).then(function(e){e&&dt.a.write(function(){t.setAttribute("src",e)})})})}(e,t.position+1);var r=e.querySelector(".js-video-playlist-item-".concat(t.position));null!=r&&r.classList.add("video-playlist__item--active");var c=e.querySelector(".js-video-playlist-inner");null!=c&&c.setAttribute("style","-webkit-transform: translate(".concat(n,"px);")+"transform: translate(".concat(n,"px);"))})}(n.getState(),t)}),Object(a.a)(".video-playlist__item:not(.video-playlist__item--first)").each(function(t){Object(a.a)(".youtube-media-atom__iframe",t).hide(),Object(a.a)(".video-overlay .fc-item__link",t).attr("tabindex","-1"),Object(a.a)(".video-overlay .fc-item__link",t).attr("aria-hidden","true")})},Xt=n(521),Kt=n.n(Xt),Zt=n(61);n.d(e,"init",function(){return ue});var te=function(){Pt(),r.a.on("modules:container:rendered",Pt)},ee=function(){r.a.addListeners({"modules:container:rendered":at,"page:front:ready":at})},ne=function(){var t=function(t){Object(a.a)(".js-container--toggle",Object(a.a)(t||document)[0]).each(function(t){new Q(t).addToggle()})};r.a.addListeners({"page:front:ready":t,"modules:geomostpopular:ready":Vt()(t,".js-popular-trails")})},ae=function(){i.a.get("switches.geoMostPopular")&&(new N).go()},ie=function(){i.a.get("switches.weather")&&r.a.on("page:front:ready",function(){Rt.init()})},oe=function(){Object(o.m)({min:"desktop"})&&r.a.on("page:front:ready",function(){!function t(){return dt.a.read(function(){var t=new Map;return Object(a.a)(".js-liveblog-blocks").each(function(e){var n=e.getAttribute("data-article-id");if(n){var a=t.get(n)||[];a.push(e),t.set(n,a)}}),t}).then(function(e){var n;e.size&&(n=lt.b.get("gu.liveblog.block-dates")||{},e.forEach(function(t,e){Object(u.a)("/".concat(e,".json?rendered=false"),{mode:"cors"}).then(function(a){var i=a&&a.blocks.filter(function(t){return t.id&&t.publishedDateTime&&t.body&&t.body.length>=10});i&&i.length&&(_t(e,t,i,n[e]),n[e]=i[0].publishedDateTime,lt.b.set("gu.liveblog.block-dates",n))}).catch(function(){})}),yt&&(yt-=1,setTimeout(function(){t()},1e3*bt),bt*=1))})}()})},re=function(){Object(a.a)(".js-video-playlist").each(function(t){Jt(t)})},ce=function(){r.a.emit("page:front:ready")},se=function(){var t,e,n;Object(a.a)("#flagship-audio").length>0&&((n=document.querySelectorAll("section.fc-container--tag")).length>=5&&(t=n[4],e=f()(Kt.a)({supportContributeURL:Object(Zt.b)()}),dt.a.write(function(){t.insertAdjacentHTML("afterend",e)})))},ue=function(){Object(c.b)([["f-accessibility",s.a],["f-snaps",te],["f-show-more",ee],["f-container-toggle",ne],["f-geo-most-popular",ae],["f-lazy-load-containers",st],["f-stocks",b],["f-weather",ie],["f-live-blog-updates",oe],["f-video-playlists",re],["f-audio-flagship-contributions",se],["f-finished",ce]])}}}]);
//# sourceMappingURL=graun.facia.js.map