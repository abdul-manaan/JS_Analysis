(function(){var m=window;var p=document;var g="js-sponsored-moments-dwell-time";var n="js-sponsored-moments-dwell-time-mon";var o="#applet_p_50000314";var i=m.wafer&&m.wafer.utils||null;var f=50;var k=m.innerHeight||p.documentElement.clientHeight;var q=m.innerWidth||p.documentElement.clientWidth;var b=null;var d=51;function h(){this.monInstances=[];var r=p.querySelector(o);if(r){this.findDwelltimeNodes(r);if(typeof MutationObserver!=="undefined"){var s=new MutationObserver(e.bind(this));s.observe(r,{childList:true,subtree:true});}this.handleScroll();}}function e(r){var s=this;setTimeout(function(){r.forEach(function(t){if(t.type==="childList"&&t.addedNodes&&t.addedNodes.length>0){typeof s.findDwelltimeNodes==="function"&&s.findDwelltimeNodes(t.target);}});},25);}function a(r){if(r>=75){return 3;}else{if(r>=50){return 2;}else{if(r>=25){return 1;}else{if(r>0){return 0;}}}}return 0;}function c(r){var u=r.getBoundingClientRect();if(u.top>d&&u.top<k||u.bottom>d&&u.bottom<k){var s=Math.max(u.top,d);var t=Math.min(u.bottom,k);return{min:a(Math.round(s*100/u.height)),max:a(Math.round(t*100/u.height))};}return null;}function l(){if(b){return b;}b=m.YAHOO&&m.YAHOO.i13n&&m.YAHOO.i13n.rapidInstance;return b;}function j(u){if(!u){return null;}var s={};var t=u.split(";");t.forEach(function r(v){var w=v.split(":");if(w.length>=2){s[w[0]]=w[1];}});return s;}h.prototype={findDwelltimeNodes:function(v){if(!v){return;}var t=this;var r=v;var s=r.querySelectorAll("."+g);if(s.length){s.forEach(function u(w){t.createMonitorInstance(w);if(w.classList&&w.classList.contains("js-playable-moments")){if(window.DARLA){t.renderPlayableMomentsIframe(w);}else{w.style.display="none";}}});}},createMonitorInstance:function(r){if(r){var s=j(r.getAttribute("data-dw-time"));this.monInstances.push({beaconData:s,node:r,inview:false,quadrantDwellTime:[0,0,0,0],quadrantInViewStart:[0,0,0,0]});this.startScrollHandler();r.classList&&r.classList.replace(g,n);}},startScrollHandler:function(){if(!i){i=m.wafer&&m.wafer.utils||null;}if(i&&!this.scrollHandler){this.debouncedScroll=i.throttle(this.handleScroll,f,this);this.debouncedResize=i.throttle(this.handleResize,f,this);m.addEventListener("scroll",this.debouncedScroll);m.addEventListener("resize",this.debouncedResize);this.scrollHandler=true;}},stopScrollHandler:function(){if(!this.scrollHandler){return;}if(this.debouncedScroll){m.removeEventListener("scroll",this.debouncedScroll);this.debouncedScroll=null;}if(this.debouncedResize){m.removeEventListener("resize",this.debouncedResize);this.debouncedResize=null;}this.scrollHandler=false;},fireDwelltimeBeacon:function(r,t){var v=l();if(v&&r.beaconData&&r.beaconData.ev){var w={};for(var s in r.beaconData){if(r.beaconData.hasOwnProperty(s)&&s!=="ev"){w[s]=r.beaconData[s];}}for(var u=0;u<r.quadrantInViewStart.length;u++){if(r.quadrantInViewStart[u]>0){r.quadrantDwellTime[u]+=t-r.quadrantInViewStart[u];w["pl"+(u+1)]=""+(r.quadrantDwellTime[u]/1000);}}v.beaconEvent(r.beaconData.ev,w);}},handleScroll:function(){var r=this;var s=+(new Date());this.monInstances.forEach(function(t){var u=c(t.node);if(t.inview&&!u){r.fireDwelltimeBeacon(t,s);t.inview=false;t.quadrantDwellTime=[0,0,0,0];t.quadrantInViewStart=[0,0,0,0];}else{if(u){if(!t.inview){t.inview=true;}for(var v=0;v<=t.quadrantInViewStart.length;v++){if(v>=u.min&&v<=u.max){if(!t.quadrantInViewStart[v]){t.quadrantInViewStart[v]=s;}}else{if(t.quadrantInViewStart[v]){t.quadrantDwellTime[v]+=s-t.quadrantInViewStart[v];}}}}}});},handleResize:function(){k=m.innerHeight||p.documentElement.clientHeight;q=m.innerWidth||p.documentElement.clientWidth;this.handleScroll();},renderPlayableMomentsIframe:function(s){if(s.hasAttribute("data-playable-src")){var r=s.getAttribute("data-playable-src");this.renderIframeInDarla(r);}},renderIframeInDarla:function(v){var s=this;if(!window.DARLA.inProgress()){var u={dest:"defaultPLAYMOMENTS",flex:{w:{min:375}},h:667,id:"PLAYMOMENTS",w:375,supports:{"exp-ovr":1,"exp-push":1,"resize-to":1}};window.DARLA.addPos(u);var r=new window.DARLA.Response("PLAYMOMENTS",{});var t='<iframe src="'+v+'" width="'+q+'" height="'+k+'" scrollable="no" frameborder="no"></iframe>';r.add("PLAYMOMENTS",t);window.DARLA.render(r);}else{setTimeout(function(){s.renderIframeInDarla(v);},500);}}};setTimeout(function(){new h();},200);})();/* Copyright (c) 2019, Yahoo! Inc.  All rights reserved. */
