"use strict";function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}(function(){"use strict";var r=Math.round,s=Math.max;function a(){clearTimeout(B),A.loadEventEnd?l():setTimeout(a,100)}function b(){var a=d(),b=A.secureConnectionStart,g=A.connectEnd,i=A.domainLookupEnd,j=A.domainLookupStart,l=A.connectStart,n=A.responseStart,o=A.fetchStart,p=A.responseEnd,q=A.domInteractive,r=A.domContentLoadedEventStart,s=A.domContentLoadedEventEnd,t=A.loadEventEnd,u={hostname:location.hostname,browser:y,category:z,page:w,type:h(),speed:e(a),ssl:b?k(g-b):0,dns:k(i-j),connect:k(g-l),wait:k(n-g),ttfb:k(n-o),backend:k(p-o),onResponse:k(p-n),domBeforeInteractive:k(q-p),domBeforeReady:k(r-q),onDomLoaded:k(s-r),domReady:k(s-o),onLoad:k(t-o)};if(window.chrome&&"function"==typeof window.chrome.loadTimes){var v=1e3*window.chrome.loadTimes().firstPaintTime;v&&(u.firstPaint=k(v-o))}if(m(a)){var x=c(a);x&&(u.internal=x.internal,u.external=x.external),u.imageNodes=f(a)}return u}function c(a){for(var b=Math.min,c,d={internal:{},external:{}},e=0;e<a.length;e++){c=a[e],d[c.origin][c.extension]||(d[c.origin][c.extension]={count:0,cache:0,min:1/0,max:-Infinity,size:0});var f=d[c.origin][c.extension];f.count++;var g=c.size.encoded||c.size.decoded||c.size.transfer;if(g&&(f.size+=g),c.response.end){var h=c.response.end-c.response.start;0<h&&(f.min=b(f.min,h),f.max=s(f.max,h))}c.cached&&f.cache++,f.phases||(f.phases=[]),c.phases&&f.phases.push(c.phases)}return Object.values(d).forEach(function(a){return Object.values(a).forEach(function(a){var b=a.phases;return delete a.phases,Object.assign(a,q(o(b)))})}),d}function d(){if("function"!=typeof window.performance.getEntriesByType)return null;for(var a=[],b=window.performance.getEntriesByType("resource")||[],c=0;c<b.length;c++){var d=b[c],e=d.name.match(v);if(e){var f={origin:i(d.name),extension:e[1],size:{transfer:d.transferSize,encoded:d.encodedBodySize,decoded:d.decodedBodySize},response:{start:d.responseStart,end:d.responseEnd},fetchStart:d.fetchStart,phases:n(d),cached:j(d)};if("jpg"===f.extension){var g=d.name.match(u);g&&(f.meta={node:g[1],dim:g[2]})}a.push(f)}}var h=window.performance.getEntriesByType("navigation");return h&&h.length&&(h=h[0],a.push({origin:"internal",extension:"html",size:{transfer:h.transferSize,encoded:h.encodedBodySize,decoded:h.decodedBodySize},response:{start:A.responseStart,end:A.responseEnd}})),a.length?a:null}function e(a){var b=0;if(!a)return null;for(var c,d=0;d<a.length;d++)if(c=a[d],"internal"===c.origin&&c.size.transfer&&5000<c.size.transfer&&c.response.start&&c.response.end){var e=c.size.transfer/(c.response.end-c.response.start);e>b&&(b=e)}return 0===b?null:{value:r(b),type:g(b)}}function f(a){for(var b,c=[],d=0;d<a.length;d++)(b=a[d],"jpg"===b.extension&&!b.cached&&0!==b.size.transfer&&0!==b.fetchStart&&b.meta)&&c.push([b.meta.node,b.meta.dim,r(b.response.end-b.fetchStart)]);return c.length?c:null}function g(a){for(var b=0;b<t.length;b++)if(a<t[b].max)return t[b].name;return t[b-1].name}function h(){var a=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;if(a&&a.type){if(isNaN(+a.type))return a.type;for(var b in a)if(a.hasOwnProperty(b)&&a[b]===a.type&&"type"!=b){switch(b){case"ETHERNET":return"ethernet";case"WIFI":return"wifi";case"CELL_2G":case"CELL_3G":return"cellular";}break}}return"unknown"}function i(a){return /^https?:\/\/[^\/]+\.avito\.[a-z]+\//i.test(a)?"internal":"external"}function j(a){var b=a.transferSize,c=a.decodedBodySize,d=a.duration;return!(0<b)&&(!!(0<c)||30>d)}function k(a){return s(a,0)}function l(){var a=b();new Image().src="https://www.avito.ru/stat/fe?data="+JSON.stringify(a)}function m(a){var b=document.cookie.match("^(.*;)?\\s*need_pixel_stat\\s*=\\s*[^;]+(.*)?$");return!!(a&&(b||2>r(100*Math.random())))}function n(a){var b=a.startTime,c=a.fetchStart,d=a.domainLookupStart,e=a.domainLookupEnd,f=a.connectStart,g=a.connectEnd,h=a.requestStart,i=a.responseStart,j=a.responseEnd,k=a.transferSize,l=a.secureConnectionStart,m=c-b,n=e-d,o=g-f,p=i-h,q=k/(j-i),r=l?g-l:0,s=n+m+o+p,t=.1<s&&0<q?s/q:0;return{redirect:m,dns:n,tcp:o,request:p,ttfb:i-b,rateRequestToSpeed:t,speed:q,ssl:r}}function o(a){return a.reduce(function(a,b){return Object.entries(b).forEach(function(b){var c=_slicedToArray(b,2),d=c[0],e=c[1];a[d]||(a[d]=[]),0<e&&a[d].push(e)}),a},{})}function p(a,b){return Object.entries(a).reduce(function(a,c){var d=_slicedToArray(c,2),e=d[0],f=d[1];return a[e]=b(f,e),a},{})}function q(a){return p(a,function(a){var b=a.filter(function(a){return 0<a}).sort(function(c,a){return c-a}),c=0==b.length%2,d=Math.floor(b.length/10),e=Math.ceil((b.length-1)/2),f=e-d,g=e+d+(c?0:1),h=f===g?b.slice(f-1,g+1):b.slice(f,g);return h.reduce(function(a,b){return a+b},0)/(h.length||1)})}if(function(){return window.performance&&window.performance.timing&&(window.performance.timing.navigationStart||window.performance.timing.fetchStart)}()){var t=[{name:"gprs",max:50},{name:"2g",max:150},{name:"2g_plus",max:450},{name:"3g",max:750},{name:"3g_plus",max:1500},{name:"4g",max:5e3},{name:"wifi",max:1/0}],u=/(\d+).img.avito.st\/([\dx]+)/,v=/\.(css|js|png|jpg|jpeg|gif|svg|woff|woff2|ttf)(?:$|\?)/i,w=avito.pageId||null,x=avito.metrics||{browser:null,categoryId:null},y=x.browser;y||(y="unknown");var z=x.categoryId,A=window.performance.timing,B=setTimeout(function(){window.removeEventListener("load",a),l()},6e4);window.addEventListener("load",a)}})();
