(function($,window){var core=window.wp_pb=window.wp_pb||{};var nav=core.nav=core.nav||{};var SCROLL_DEBOUNCE_TIME=20;var wpHeader={isHomepage:$("#logo-in-nav").hasClass("homePage"),init:function(){if($("#page").hasClass("ie8"))return;else{if($("#article-full-width-content").length===0)if($("#pb-root .pb-f-page-header-v2").length){var $header=$(".pb-f-page-header-v2");$("#pb-root").before($header)}if(window.ActiveXObject||"ActiveXObject"in window){$("#main-sections-nav").addClass("ie");$("#wp-header").addClass("ie")}$("#sections-menu-off-canvas ul.side-nav li").each(function(){if($(this).hasClass("nav-screenreader-link"))return;
var item=$(this).find("\x3ea"),itemText=item.html().replace(/\s+/g,"").replace(/&/g,"-").toLowerCase(),itemLink=item.attr("href");if($(this).hasClass("main-nav"))item.attr("href",itemLink+"?nid\x3dmenu_nav_"+itemText);else if($(this).hasClass("sub-nav-item")){var mainItem=$(this).parents(".main-nav").find("\x3ea").text().replace(/\s+/g,"").replace(/&/g,"-").toLowerCase();item.attr("href",itemLink+"?nid\x3dmenu_nav_"+mainItem+"-"+itemText)}});$("#sections-menu-wide li").each(function(){var item=$(this).find("a"),
itemText=item.html().replace(/\s+/g,"").replace(/&/g,"-").toLowerCase(),itemLink=item.attr("href");item.attr("href",itemLink+"?nid\x3dtop_nav_"+itemText)});(function(){var searchIconHovered;$("#search-btn").click(function(e){e.stopPropagation();e.preventDefault();if($(this).hasClass("closed")){$(this).removeClass("closed").addClass("opened");$("#search-field").removeClass("closed").addClass("opened");$("#search-field").focus()}else if($(this).hasClass("opened"))$("#search-form").submit()});$("#search-btn").on("mouseover",
function(){if($(this).hasClass("opened"))searchIconHovered=true}).on("mouseout",function(){if($(this).hasClass("opened"))searchIconHovered=false});$("#search-field").on("blur",function(){if($(this).hasClass("opened")&&!searchIconHovered){$(this).removeClass("opened").addClass("closed");$("#search-btn").removeClass("opened").addClass("closed")}});$("#search-form, #nav-search-mobile").submit(function(){if($(this).find("input[type\x3dtext]").val()){if(!!window.s&&!!s.sendDataToOmniture)s.sendDataToOmniture("Search Submit",
"event2",{eVar38:$(this).find("input[type\x3dtext]").val(),eVar1:s.pageName});return true}else return false})})();(function(){var timer;$("#sections-menu-off-canvas li a").hover(function(){$(this).addClass("hover-name");$(this).parent().addClass("unhover-list")},function(){$(this).removeClass("hover-name");$(this).parent().removeClass("unhover-list")});$("#nav-user").click(function(){if($("body").hasClass("left-menu left-menu-pb")){$("body").removeClass("left-menu left-menu-pb");$("#main-sections-nav").removeClass("active");
$(".section-menu-btn").removeClass("active")}$("#user-menu").toggleClass("nav-user-show");$("body").toggleClass("account-menu")});$("#settings-nav-btn").click(function(){if($("body").hasClass("left-menu left-menu-pb")){$("body").removeClass("left-menu left-menu-pb");$("#main-sections-nav").removeClass("active");$(".section-menu-btn").removeClass("active")}if($("#logged-in-status").hasClass("logged-in"))$("#user-menu").toggleClass("nav-user-show");else $(".sign-up-buttons").toggleClass("nav-user-show");
$("body").toggleClass("account-menu")});$(document).on("click",".section-menu-btn",function(event){event.stopPropagation();event.preventDefault();if($("html").hasClass("drawbridge-up"))return;var _clickElement=$(this),_menuElement=$("#main-sections-nav");if(_menuElement.hasClass("active")){$("body").removeClass("left-menu left-menu-pb");_clickElement.removeClass("active");_menuElement.removeClass("active");if(typeof window.wp_pb=="object"&&typeof window.wp_pb.report=="function"){wp_pb.report("nav",
"menu_start_close",true);setTimeout(function(){wp_pb.report("nav","menu_finish_close",true)},500)}}else{if($("body").hasClass("account-menu")){$("body").removeClass("account-menu");$("#user-menu").removeClass("nav-user-show");$(".sign-up-buttons").removeClass("nav-user-show")}$("body").addClass("left-menu left-menu-pb");if(!$.trim($("#sections-menu-off-canvas").html()).length){var siteurl="";var contentUri=!wpHeader.isHomepage&&wp_pb.canonical_url?"\x26contentUri\x3d"+wp_pb.canonical_url:"";if($(".pb-f-page-header-v2 #page").hasClass("offsite"))siteurl=
"https://www.washingtonpost.com/pb/api/v2/render/feature/page/header-v2?shownav\x3dshownav";else siteurl="/pb/api/v2/render/feature/page/header-v2?shownav\x3dshownav"+contentUri;$.get(siteurl,function(data){var rootEl=$(data.rendering);var subscribeNav=rootEl.find("#subscribe-left-nav");$(".pb-f-page-header-v2").find("#main-sections-nav-inner").append(subscribeNav);var searchNav=rootEl.find("#search-nav-wrapper");$(".pb-f-page-header-v2").find("#main-sections-nav-inner").append(searchNav);var rootContent=
rootEl.find("#sections-menu-off-canvas");$(".pb-f-page-header-v2").find("#main-sections-nav-inner").append(rootContent);var footerNav=rootEl.find("#site-attribution-off-canvas-menu");$(".pb-f-page-header-v2").find("#main-sections-nav-inner").append(footerNav);if(!$("#main-sections-nav").hasClass("hide-subscribe-left-nav"))$("#subscribe-left-nav").removeClass("hidden");wpHeader.initRegionalToggle();var subButtonArray=document.querySelectorAll("#subscribe-left-nav .button.subscribe");subButtonArray.forEach(function(subButtonItem){subButtonItem.addEventListener("click",
function(){document.dispatchEvent(new CustomEvent("twp_tracking",{detail:"subscribe_btn"}))},true)})})}_clickElement.addClass("active");_menuElement.addClass("active");if(typeof window.wp_pb=="object"&&typeof window.wp_pb.report=="function"){wp_pb.report("nav","menu_start_open",true);setTimeout(function(){wp_pb.report("nav","menu_finish_open",true)},500)}}calcSubnavPosition()});function delayHover(element){timer=setTimeout(function(){$("#main-sections-nav").addClass("subNavigation");$(element).addClass("hover")},
75)}$(document).on({mouseenter:function(){delayHover($(this))},mouseleave:function(){$(this).removeClass("hover");$("#main-sections-nav").removeClass("subNavigation");clearTimeout(timer)}},".main-nav");if($(window).width()<=480)$(".main-nav").click(function(){location.href=$(this).find(".main-nav-item").attr("href")})})()}},setupNav:function(){$.fn.appendLinkItems=function(links,surroundingTag){var element=this;surroundingTag=surroundingTag||"\x3cli\x3e";$.each(links,function(i,link){var a=$("\x3ca\x3e");
if(link.title)a.text(link.title);if(link.html)a.html(link.html);if(link.href)a.attr("href",link.href);if(link.attr)a.attr(link.attr);if(link["class"])a.addClass(link["class"]);element.append($(surroundingTag).append(a).addClass(link.selected?"selected":"").append("\x3chr /\x3e"))});return this};nav.setIdentityMenu=function(menu){var element=$("#user-menu ul.user-info");element.children("li").remove();element.appendLinkItems(menu)};nav.closeDropdowns=function(){$("#wp-header .dropdown-trigger.active").each(function(){$(this).removeClass("active");
$("#"+$(this).data("menu")).hide()});$(".leaderboard").removeClass("hideAd")};nav.showNav=function(){if(typeof window.wp_pb=="object"&&typeof window.wp_pb.report=="function"&&$("#wp-header").hasClass("bar-hidden")){wp_pb.report("nav","start_open",true);setTimeout(function(){$("#wp-header").removeClass("bar-hidden site-header-is-colored");wp_pb.report("nav","finish_open",true)},250)}};nav.hideNav=function(){if(typeof window.wp_pb=="object"&&typeof window.wp_pb.report=="function"&&!$("#wp-header").hasClass("bar-hidden")){wp_pb.report("nav",
"start_close",true);setTimeout(function(){wp_pb.report("nav","finish_close",true);$("#wp-header").addClass("bar-hidden")},250)}}},setScrollEvents:function(){var isHomepage=$("#logo-in-nav").hasClass("homePage"),scrollPos=$(this).scrollTop()||0,isMobileDevice=isMobile(),notificationBar=$(".pb-f-page-notification-bar"),notificationOffset=0;if(notificationBar.length)notificationOffset=notificationBar.outerHeight();if(isHomepage){$("#logo-in-nav").removeClass("nav-display-show").addClass("nav-display-hide");
$(".main-navigation").removeClass("nav-logo-display-show");$("#sections-menu-wide").addClass("nav-display-show").removeClass("nav-display-hide");$(window).scroll(wp_pb.StaticMethods.debounce(function(){if(isMobileDevice&&$("#main-sections-nav").hasClass("active"))return false;var navchange=false,widthbreak=768,window_width=$(window).width(),y_scroll_pos=window.pageYOffset,scroll_pos_test=80;if(window_width>991)$("#logo-in-nav").addClass("nav-display-hide-tagline");if(window_width>=widthbreak)if(y_scroll_pos>
scroll_pos_test&&navchange==false){navchange=true;$("#sections-menu-wide").removeClass("nav-display-show").addClass("nav-display-hide");$("#logo-in-nav").addClass("nav-display-show").removeClass("nav-display-hide");$(".main-navigation").addClass("nav-logo-display-show")}else if(y_scroll_pos<=0){navchange=false;if(!$("#section-menu-btn").hasClass("active")){$("#logo-in-nav").removeClass("nav-display-show").addClass("nav-display-hide");$(".main-navigation").removeClass("nav-logo-display-show");$("#sections-menu-wide").addClass("nav-display-show").removeClass("nav-display-hide")}}if($("#main-sections-nav").hasClass("active"))calcSubnavPosition()},
SCROLL_DEBOUNCE_TIME))}else if(!isHomepage||isMobileDevice){var timeOutTime=100,scrollHeight=150;if(isMobileDevice){scrollHeight=30;timeOutTime=25}$(window).scroll(wp_pb.StaticMethods.debounce(function(){if(isMobileDevice&&$("#main-sections-nav").hasClass("active"))return false;if(!$("#section-menu-btn").hasClass("active")){var currentPos=$(this).scrollTop();if(currentPos+80<scrollPos||currentPos===0){var copyPos=currentPos;setTimeout(function(){var lastPos=$(this).scrollTop();if(copyPos-lastPos>
scrollHeight||currentPos===0){nav.showNav();scrollPos=currentPos}},timeOutTime)}else if(currentPos-80>scrollPos&&currentPos>50+notificationOffset){var hidenav=true;if(isMobile()&&window.matchMedia("(orientation: landscape)").matches&&($("#user-menu").hasClass("nav-user-show")||$(".sign-up-buttons").hasClass("nav-user-show")))hidenav=false;if($("header").hasClass("dont-hide-header-on-scroll"))hidenav=false;if(hidenav){nav.hideNav();scrollPos=currentPos;$("body").removeClass("account-menu");$("#user-menu").removeClass("nav-user-show");
$(".sign-up-buttons").removeClass("nav-user-show")}}}if($("#main-sections-nav").hasClass("active"))calcSubnavPosition()},SCROLL_DEBOUNCE_TIME))}$(window).resize(function(){nav.closeDropdowns();if(isHomepage&&$(window).width()<991)if($("#logo-in-nav").hasClass("nav-display-hide-tagline"))$("#logo-in-nav").removeClass("nav-display-hide-tagline");if(isHomepage&&$(window).width()>991)if(!$("#logo-in-nav").hasClass("nav-display-hide-tagline"))$("#logo-in-nav").addClass("nav-display-hide-tagline")});$(function(){wp_pb.register("nav",
"force-show",function(){nav.showNav()})});if(isMobile()){$(document).mouseup(function(e){if(e.target.id=="mobile-hamburger-ic")return;var menuElement=$("#main-sections-nav"),container=$("#main-sections-nav");if(menuElement.hasClass("active")&&!container.is(e.target)&&(container.has(e.target).length===0||e.target.id=="main-sections-nav-inner")){$("body").removeClass("left-menu left-menu-pb");$(".section-menu-btn").removeClass("active");menuElement.removeClass("active");if(typeof window.wp_pb=="object"&&
typeof window.wp_pb.report=="function"){wp_pb.report("nav","menu_start_close",true);setTimeout(function(){wp_pb.report("nav","menu_finish_close",true)},500)}}});$(document).bind("touchend",function(e){var container=$(".sign-up-buttons");if(!container.is(e.target)&&container.has(e.target).length===0&&$(".sign-up-buttons").hasClass("nav-user-show")&&e.target.id!=="settings-nav-btn"){$(".sign-up-buttons").removeClass("nav-user-show");$("body").removeClass("account-menu")}});$(document).bind("touchend",
function(e){var container=$("#main-sections-nav");if(!container.is(e.target)&&container.has(e.target).length===0&&$("#main-sections-nav").hasClass("active")&&e.target.id!=="section-menu-btn"&&e.target.parentNode.id!=="section-menu-btn"&&e.target.id!=="mobile-hamburger-ic"){$("#main-sections-nav, .section-menu-btn").removeClass("active");$("body").removeClass("left-menu left-menu-pb")}});$(document).bind("touchend",function(e){var container=$("#user-menu");if(!container.is(e.target)&&container.has(e.target).length===
0&&$("#user-menu").hasClass("nav-user-show")&&e.target.id!=="settings-nav-btn"&&e.target.parentNode.id!=="nav-user"&&e.target.className!=="username"){$("#user-menu").removeClass("nav-user-show");$("body").removeClass("account-menu")}})}$(document).mouseup(function(e){var container=$("#user-menu");if(!container.is(e.target)&&container.has(e.target).length===0&&$("#user-menu").hasClass("nav-user-show")&&e.target.id!=="settings-nav-btn"&&e.target.parentNode.id!=="nav-user"&&e.target.className!=="username"){$("#user-menu").removeClass("nav-user-show");
$("body").removeClass("account-menu")}});$(document).mouseup(function(e){var container=$("#main-sections-nav");if(!container.is(e.target)&&container.has(e.target).length===0&&$("#main-sections-nav").hasClass("active")&&e.target.id!=="section-menu-btn"&&e.target.parentNode.id!=="section-menu-btn"&&e.target.id!=="mobile-hamburger-ic"){$("#main-sections-nav, .section-menu-btn").removeClass("active");$("body").removeClass("left-menu left-menu-pb")}})},setIdentity:function(){var idp;nav.getIdentityProvider=
function(){return idp};nav.setIdentityProvider=function(provider){var ef=function(){};idp={};idp.name=provider.name||"";idp.getUserId=provider.getUserId||ef;idp.getUserMenu=provider.getUserMenu||ef;idp.getSignInLink=provider.getSignInLink||ef;idp.getRegistrationLink=provider.getRegistrationLink||ef;idp.isUserLoggedIn=provider.isUserLoggedIn||ef;idp.render=provider.render||function(){if(idp.isUserLoggedIn()){$("#nav-user .username").text(idp.getUserId());nav.setIdentityMenu(idp.getUserMenu());$("#nav-user, #user-menu, .site-info .account-menu").removeClass("hidden");
$("#logged-in-status").addClass("logged-in");var _gifthref=$("#nav-gift a").attr("data-link");var _gifttid=$("#nav-gift a").attr("data-tid");$("#nav-gift a").attr("href",_gifthref+"\x26tid\x3d"+_gifttid);$(document).on("onTwpMeterReady",function(){if(!wp_pb.StaticMethods.isSubscriber()){$("#user-menu").addClass("no-subscriber");$("#nav-subscribe, #subscribe-left-nav").removeClass("hidden");$("#logged-in-status.logged-in #nav-subscribe").css("display","block");$("#main-sections-nav").removeClass("hide-subscribe-left-nav")}})}else{$("#sign-in-link").attr("href",
idp.getSignInLink()+"?nid\x3dtop_pb_signin\x26tid\x3dnav_sign_in");$(".nav-sign-in, #nav-subscribe, #nav-subscribe-mobile, #subscribe-left-nav").removeClass("hidden");$("#main-sections-nav").removeClass("hide-subscribe-left-nav")}};nav.renderIdentity()};nav.renderIdentity=function(callback){callback=callback||function(){};if(idp)idp.render();callback(idp)};var showIdentity=$("#nav-user").data("show-identity");var current=window.location.href.split("?")[0];var twpIdentity={name:"TWP",getUserId:function(){var username=
TWP.Util.User.getUserName();var userid=TWP.Util.User.getUserId();if(typeof username=="string"&&username.length>0)return username;else return userid},getUserMenu:function(){return[{title:TWP.Util.User.getUserId(),href:TWP.signin.profileurl+current+"\x26tid\x3dnav_acctmgnt_menu\x26refresh\x3dtrue","class":"account"},{title:"Sign out",href:TWP.signin.logouturl_page+"?tid\x3dnav_acctmgnt_menu"}]},getSignInLink:function(){return TWP.signin.loginurl_page+current},getRegistrationLink:function(){return TWP.signin.registrationurl_page+
current},isUserLoggedIn:function(){return TWP.Util.User?TWP.Util.User.getAuthentication():false}};if(showIdentity)(function checkTWP(){if(!nav.getIdentityProvider())if(TWP&&TWP.signin&&TWP.Util){nav.setIdentityProvider(twpIdentity);nav.renderIdentity()}else window.setTimeout(function(){checkTWP()},200)})()},initMastheadCorrelation:function(){if(typeof window.wp_pb=="object"&&typeof window.wp_pb.register=="function")wp_pb.register("masthead","masthead-init-correlation",function(maxSpace){$("#wp-header").addClass("move-for-masthead");
$("#pb-root").addClass("move-for-masthead");if(maxSpace==undefined)maxSpace=30;wp_pb.register("masthead","masthead-add-space",function(object){if(object.movableSpace<=maxSpace&&object.cssObj!=undefined){$("#wp-header").css(object.cssObj);$("#pb-root").css(object.cssObj)}});wp_pb.register("masthead","masthead-remove-space",function(cssObj){if(cssObj!=undefined){$("#wp-header").css(cssObj);$("#pb-root").css(cssObj)}})})},initRegionalToggle:function(){$(".main-nav.has-info .additional-inline-info a").each(function(){if($(this).text().indexOf("Regional")>
0)$(this).on("click",function(){wp_pb.StaticMethods.setRegionCookie(1)});else if($(this).text().indexOf("World")>0)$(this).on("click",function(){wp_pb.StaticMethods.setRegionCookie(0)})})}};function isMobile(){if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Kindle/i)||navigator.userAgent.match(/Windows Phone/i))return true;else return false}
function calcSubnavPosition(){$("#sections-menu-off-canvas \x3e ul \x3e li").each(function(){if(!$("#main-sections-nav").hasClass("active"))return;if($(this).hasClass("has-sub")){var movetop=$(this).find("ul").height()/2-10,offsetY=$(this).offset().top-$(window).scrollTop();if(offsetY<94)movetop=0;else if(offsetY-movetop<95)movetop=offsetY-95;$(this).find("ul").css("top","-"+movetop+"px")}})}wpHeader.init();wpHeader.setupNav();wpHeader.setScrollEvents();wpHeader.setIdentity();wpHeader.initMastheadCorrelation()})(jQuery,
window);
(function($){var wpVoltronGallery=function(rootEl){var mainRoot=rootEl;var uniqueId="gallery_"+Math.floor(Math.random()*1E5);$(mainRoot).attr("id",uniqueId);var logger=TWP&&TWP.Tools&&TWP.Tools.logger?new TWP.Tools.logger("SLIDESHOW"):window.console;var ec=new EventController(function(text){logger.log(text)});var config={sizeBreakpoint:768,imageBreakpoints:[358,606,1024,2E3,3200],resizedDebounceTime:300,navWidthFraction:.5,navWidthMargin:70,forwardBuffer:5,backBuffer:2,adEnabled:true,adFrequency:9,adTime:1.5,
autoplayTime:4,slideTransitionMS:300,buyUrl:"http://washingtonpost.mycapture.com/mycapture/remoteimage.asp?image\x3d[small_url]\x26notes\x3d[full_url]",votePostUrl:"//apps.washingtonpost.com/f/vote-builder/vote",startInlineInFullscreenMobile:false};var placementSettings={isGalleryPage:mainRoot.hasClass("wp-volt-gal-p-gallery-page"),disablePreroll:mainRoot.hasClass("wp-volt-gal-p-disable-preroll")||document.body.getAttribute("data-no_ads")=="true",disableAds:mainRoot.hasClass("wp-volt-gal-p-disable-ads")||
document.body.getAttribute("data-no_ads")=="true",photoCover:mainRoot.hasClass("wp-volt-gal-p-photo-cover"),endMode:mainRoot.hasClass("wp-volt-gal-p-end-circular")?"circular":"next-inline",disableCaption:mainRoot.hasClass("wp-volt-gal-p-disable-caption"),fixSizeMode:mainRoot.hasClass("wp-volt-gal-p-fix-size-mode"),aspectRatioHeight:mainRoot.hasClass("wp-volt-gal-p-ratio-height"),transformProp:false,useTouchEvents:false,showEmbedPromo:mainRoot.hasClass("wp-volt-gal-embed-promo"),autoAutoplay:mainRoot.hasClass("wp-volt-gal-autoplay"),
continuousAutoplay:mainRoot.hasClass("wp-volt-gal-continuous-autoplay")};var galSettings=mainRoot.data();var state={isPromoStub:mainRoot.hasClass("wp-volt-gal-promo-stub"),sizeMode:"unknown",fullscreen:false,isFirstGallery:true,blockUI:false,photoEls:null,itemData:{},itemIndex:0,itemType:"photo",nextItemIndex:0,itemsSinceAd:0,okToFirePageView:false,totalItems:10,prerollShown:false,autoplaying:false};var initFeature=function(){var initContainer=function(){if(!!window.mobile_browser||!placementSettings.isGalleryPage&&
!placementSettings.showEmbedPromo)state.delayPreroll=true};var initDevice=function(){function transform_prop(){var prefixes="transform WebkitTransform MozTransform OTransform msTransform".split(" ");for(var i=0;i<prefixes.length;i++)if(document.createElement("div").style[prefixes[i]]!==undefined)return prefixes[i];return false}placementSettings.useTouchEvents=window.Modernizr&&window.Modernizr.touchevents||window.mobile_browser;placementSettings.transformProp=transform_prop();if(wp_pb.BrowserInfo.browser==
"Chrome"||wp_pb.BrowserInfo.OS=="iPhone"||wp_pb.BrowserInfo.OS=="iPad")mainRoot.addClass("wp-volt-gal-filters-enabled")};initContainer();initDevice()};var GalleryController=function(){var nextGalleryLoaded=function(data){if(data.rendering){state.isPromoStub=false;state.isFirstGallery=false;state.nextGal=$(data.rendering).find(".wp-volt-gal");galSettings=state.nextGal.data();mainRoot.data(galSettings);ec.report("gallery_loaded",null,true);initGallery();ec.report("gallery_changed")}};var loadNextGallery=
function(){state.prerollShown=false;galSettings.showPreroll=galSettings.nextGalShowPreroll;galSettings.prerollZone=galSettings.nextGalPrerollZone;if(prerollCheck())ec.report("ad.show_preroll");$.ajax({url:"/pb/api/v2/render/feature",dataType:"json",data:{id:state.pbContentId,uri:galSettings.nextGalUrl,contentUri:galSettings.nextGalUrl,columns:3,"pb.promoSlide":"false"},cache:true,jsonCallback:"wpVoltGalAjax",success:nextGalleryLoaded})};var nextItem=function(){if(state.blockUI)return;if(state.itemIndex<
state.totalItems-1){state.nextItemIndex=state.itemIndex+1;gotoItem()}else if(galSettings.nextGalUrl)loadNextGallery();else{state.nextItemIndex=0;gotoItem()}};var prevItem=function(){if(state.blockUI)return;if(state.itemIndex>0){state.nextItemIndex=state.itemIndex-1;gotoItem()}};var thatItem=function(itemIndex){if(state.blockUI)return;if(state.itemIndex!=itemIndex){state.nextItemIndex=itemIndex;gotoItem()}};var gotoItem=function(skipAdsCheck){if(skipAdsCheck||adsCheck()){state.itemIndex=state.nextItemIndex;
var itemEl=state.photoEls.eq(state.itemIndex);state.itemEl=itemEl;state.itemData=itemEl.data();state.itemType=itemEl.hasClass("wp-volt-gal-title")?"title":itemEl.hasClass("wp-volt-gal-promo")?"promo":"photo";ec.report("item_changed")}};var prerollCheck=function(){if(!state.prerollShown&&!placementSettings.disablePreroll&&(galSettings.showPreroll==""||galSettings.showPreroll))return true;return false};var adsCheck=function(){if(!placementSettings.disablePreroll&&state.delayPreroll&&prerollCheck()){ec.report("ad.show_preroll");
return false}if(!placementSettings.disableAds&&galSettings.showInterstitials&&++state.itemsSinceAd>=config.adFrequency){ec.report("ad.show_interstitial");state.itemsSinceAd=0;return false}return true};var prerollDone=function(){state.prerollShown=true;gotoItem()};var interstitialDone=function(){gotoItem(true)};var initGallery=function(){state.photoEls=mainRoot.find(".wp-volt-gal-photos").children();state.totalItems=state.photoEls.length;state.nextItemIndex=0;state.itemIndex=0;state.itemsSinceAd=0;
if(state.photoEls.last().hasClass("wp-volt-gal-promo")){galSettings.nextGalUrl=state.photoEls.last().data("url");galSettings.nextGalShowPreroll=state.photoEls.last().data("showPreroll");galSettings.nextGalPrerollZone=state.photoEls.last().data("prerollZone")}state.nextGal=null;gotoItem(true)};var init=function(){state.pbContentId=mainRoot.parent()[0].id;initGallery();if(!state.delayPreroll&&prerollCheck())ec.report("ad.show_preroll")};ec.register({"user.next":nextItem,"user.prev":prevItem,"user.goto":thatItem,
"autoplay.next":nextItem,"ad.preroll_done":prerollDone,"ad.interstitial_done":interstitialDone,loaded:init},this)};var KeyController=function(){var keyDown=function(event){var key=event.which?event.which:event.keyCode;if(key==37)ec.report("user.prev");else if(key==39)ec.report("user.next");else if(key==38)ec.report("user.details_open");else if(key==40)ec.report("user.details_close");else if(key==27)ec.report("user.fullscreen_close",null,true)};var init=function(){if(placementSettings.isGalleryPage)$(document).keydown(keyDown);
else ec.register({fullscreen_open:function(){$(document).keydown(keyDown)},fullscreen_close:function(){$(document).off("keydown")}},this)};ec.register({loaded:init},this)};var TouchController=function(){var sliderEl=mainRoot.find(".wp-volt-gal-photos");var listenEl=mainRoot.find(".wp-volt-gal-main");var tapListenEl=mainRoot;var initSwiping=function(){var pane_width=sliderEl.width();var handleTap=function(ev){ev.gesture.preventDefault();ev.gesture.stopPropagation();$(ev.gesture.target).click()};var handleHammer=
function(ev){ev.gesture.preventDefault();ev.gesture.stopPropagation();var prevTime=Date.now().toString();switch(ev.type){case "dragright":case "dragleft":var index=state.itemIndex;var sliderPos=-100*index;var offsetPos=ev.gesture.deltaX/pane_width*100;var position=sliderPos+offsetPos;sliderEl.addClass("no-transitions");sliderEl[0].offsetHeight;if(prevTime<Date.now()){sliderEl.css({transform:"translateX("+position+"%)","-moz-transform":"translateX("+position+"%)","-webkit-transform":"translateX("+
position+"%)","-o-transform":"translateX("+position+"%)","-ms-transform":"translateX("+position+"%)"});prevTime=Date.now().toString()}else;break;case "swipeleft":ec.report("user.next");ev.gesture.stopDetect();break;case "swiperight":ec.report("user.prev");ev.gesture.stopDetect();break;case "release":sliderEl.removeClass("no-transitions");sliderEl[0].offsetHeight;if(Math.abs(ev.gesture.deltaX)>pane_width/2)if(ev.gesture.direction=="right")ec.report("user.prev");else ec.report("user.next");else{position=
-100*state.itemIndex;sliderEl.css({transform:"translateX("+position+"%)","-moz-transform":"translateX("+position+"%)","-webkit-transform":"translateX("+position+"%)","-o-transform":"translateX("+position+"%)","-ms-transform":"translateX("+position+"%)"})}break}};var hammertime=new Hammer(listenEl[0],{drag_lock_to_axis:true,prevent_mouseevents:true});hammertime.on("release dragleft dragright swipeleft swiperight",handleHammer);if((wp_pb.BrowserInfo.browser=="Chrome"||wp_pb.BrowserInfo.OS=="iPhone"||
wp_pb.BrowserInfo.OS=="iPad")&&window.mobile_browser){var hammertime2=new Hammer(tapListenEl[0],{prevent_mouseevents:true});hammertime2.on("tap",handleTap)}};var adHandler=function(){if(window.mobile_browser){$("#"+uniqueId+" #wpni_adi_bigbox_gallery").after('\x3cdiv class\x3d"wpni_adi_bigbox_gallery_swipe"\x3e\x3c/div\x3e');var swipeAdEl=$("#"+uniqueId+" #slug_bigbox_gallery .wpni_adi_bigbox_gallery_swipe");swipeAdEl[0].addEventListener("touchend",function(e){$(this).css("height","0");var evt=document.createEvent("TouchEvent");
evt.initUIEvent("touchend",true,true);evt.pageX=e.pageX;evt.pageY=e.pageY;$(this).parent()[0].dispatchEvent(evt);setTimeout(function(){swipeAdEl.css("height","")},300)},false)}};var init=function(){if(typeof Hammer=="function"&&placementSettings.useTouchEvents)initSwiping()};ec.register({"ad.interstitial_viewed":adHandler,loaded:init},this)};var ModeController=function(){var curWidth=0;var resizeTimeout=null;var setRootClass=function(){mainRoot.removeClass("wp-volt-gal-small wp-volt-gal-large wp-volt-gal-fullscreen");
if(state.sizeMode=="large")mainRoot.addClass("wp-volt-gal-large");else if(state.sizeMode=="small")mainRoot.addClass("wp-volt-gal-small")};var resized=function(){var newWidth=mainRoot.width();if(curWidth!=newWidth){if(state.fullscreen&&curWidth>newWidth+newWidth/100*2&&!placementSettings.useTouchEvents)closeFullscreen();curWidth=newWidth;if(mainRoot.width()>=config.sizeBreakpoint){if(state.sizeMode!="large"){state.sizeMode="large";setRootClass();ec.report("size.mode_changed")}}else if(state.sizeMode!=
"small"){state.sizeMode="small";setRootClass();ec.report("size.mode_changed")}ec.report("size.resized");if(resizeTimeout!=null)clearTimeout(resizeTimeout);resizeTimeout=setTimeout(function(){ec.report("size.resized_debounce")},config.resizedDebounceTime)}};var openFullscreen=function(){if(mainRoot[0].requestFullscreen)mainRoot[0].requestFullscreen();else if(mainRoot[0].webkitRequestFullscreen)mainRoot[0].webkitRequestFullscreen();else if(mainRoot[0].mozRequestFullScreen)mainRoot[0].mozRequestFullScreen();
else if(mainRoot[0].msRequestFullscreen)mainRoot[0].msRequestFullscreen();else mainRoot.addClass("wp-volt-gal-fullscreen");state.fullscreen=true;if(mainRoot.hasClass("wp-volt-gal-fullscreen")){ec.report("size.resized");ec.report("size.resized_debounce")}ec.report("fullscreen_open")};var closeFullscreen=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitCancelFullScreen)document.webkitCancelFullScreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();
else if(document.msExitFullscreen)document.msExitFullscreen();state.fullscreen=false;if(mainRoot.hasClass("wp-volt-gal-fullscreen")){mainRoot.removeClass("wp-volt-gal-fullscreen");ec.report("size.resized");ec.report("size.resized_debounce")}ec.report("fullscreen_close")};var init=function(){if(mainRoot.hasClass("wp-volt-gal-small"))state.sizeMode="small";else if(mainRoot.hasClass("wp-volt-gal-large"))state.sizeMode="large";else resized();$(window).resize(resized);mainRoot.on("webkitfullscreenchange mozfullscreenchange fullscreenchange",
function(){state.fullscreen=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||mainRoot.hasClass("wp-volt-gal-fullscreen")})};ec.register({"user.fullscreen":openFullscreen,"user.fullscreen_close":closeFullscreen,loaded:init},this)};var TrackingController=function(){var trackingData={};var lastItemIndex=-1;var sendOmnitureEvent=function(link,event){if(!!window.s&&!!s.sendDataToOmniture)s.sendDataToOmniture(link,event)};var captionOpened=function(){sendOmnitureEvent("caption",
"event36",trackingData)};var fullscreenEnabled=function(){sendOmnitureEvent("fullscreen","event37",trackingData)};var autoplayStarted=function(){sendOmnitureEvent("autoplay","event38",trackingData)};var itemChanged=function(){if(!!window.s&&!!s.sendPageViewToOmniture&&state.itemIndex!=lastItemIndex&&state.okToFirePageView){window.wp_page_num=state.itemIndex;s.sendPageViewToOmniture($.extend({events:"event1",referrer:location.protocol+"//www.washingtonpost.com/",prop14:state.itemIndex,prop35:"washingtonpost.com",
eVar35:"washingtonpost.com"},trackingData));lastItemIndex=state.itemIndex}state.okToFirePageView=true};var updateTrackingData=function(){var shortenedUuid=galSettings.uuid.split("-")[galSettings.uuid.split("-").length-1];var d=new Date(galSettings.firstPublished*1E3);var m=d.getUTCMonth()+1;var dd=d.getUTCFullYear().toString()+(m<10?"0"+m:m)+(d.getUTCDate()<10?"0"+d.getUTCDate():d.getUTCDate());trackingData={channel:"wp - "+galSettings.section,pageName:galSettings.section+":gallery - "+shortenedUuid+
" - "+dd+" - "+galSettings.slug,eVar1:galSettings.section+":gallery - "+shortenedUuid+" - "+dd+" - "+galSettings.slug,eVar2:"wp - "+galSettings.section,eVar17:"gallery",prop2:"wp - "+galSettings.section+(galSettings.subsection?" - "+galSettings.subsection:""),prop3:"gallery",prop12:galSettings.uuid,prop13:galSettings.uuid+" - "+galSettings.title,prop23:galSettings.section+(galSettings.subsection?"|"+galSettings.subsection:"")+"|gallery",prop39:"/"+galSettings.commercialNode,prop40:galSettings.category};
if(!placementSettings.isGalleryPage)trackingData.eVar49="embed"};ec.register({item_changed:itemChanged,gallery_changed:updateTrackingData,"user.details_open":captionOpened,"user.fullscreen":fullscreenEnabled,"user.autoplay_toggle":autoplayStarted,loaded:updateTrackingData},this)};var RootClassController=function(){var setAdState=function(type){mainRoot.removeClass("wp-volt-gal-ad-lock wp-volt-gal-ad-visible");if(type=="start")mainRoot.addClass("wp-volt-gal-ad-visible wp-volt-gal-ad-lock");else if(type==
"unlock")mainRoot.addClass("wp-volt-gal-ad-visible")};var itemChanged=function(){mainRoot.removeClass("wp-volt-gal-on-first-slide wp-volt-gal-on-last-slide wp-volt-gal-on-promo-slide");if(state.itemIndex==0)mainRoot.addClass("wp-volt-gal-on-first-slide");if(state.itemType=="promo")mainRoot.addClass("wp-volt-gal-on-promo-slide");else if(state.itemType=="title")mainRoot.addClass("wp-volt-gal-on-title-slide")};var galleryChanged=function(){mainRoot.removeClass("wp-volt-gal-promo-stub")};ec.register({"ad.show_preroll":function(){setAdState("start")},
"ad.preroll_done":function(){setAdState("clear")},"ad.show_interstitial":function(){setAdState("start")},"ad.interstitial_viewed":function(){setAdState("unlock")},"ad.interstitial_done":function(){setAdState("clear")},gallery_changed:galleryChanged,item_changed:itemChanged},this)};var AutoplayController=function(){var autoplayTimeout=null;var startAutoplay=function(){state.autoplaying=true;autoplayTimeout=setTimeout(autoplayNext,config.autoplayTime*1E3);ec.report("autoplay.start")};var toggleAutoplay=
function(){if(state.autoplaying)stopAutoplay();else{state.autoplaying=true;autoplayTimeout=setTimeout(autoplayNext,config.autoplayTime*1E3);ec.report("autoplay.start")}};var autoplayNext=function(){ec.report("autoplay.next");if(state.itemIndex>=state.totalItems-2&&!placementSettings.continuousAutoplay)stopAutoplay();else autoplayTimeout=setTimeout(autoplayNext,config.autoplayTime*1E3)};var autoplayInterrupt=function(args,eventType,eventName){if(state.autoplaying&&typeof eventName=="string"&&eventName!=
"autoplay_toggle"&&eventName!="details_open"&&eventName!="details_close")stopAutoplay()};var stopAutoplay=function(){state.autoplaying=false;if(autoplayTimeout!=null)clearTimeout(autoplayTimeout);ec.report("autoplay.stop")};var sizeModeChanged=function(){};var init=function(){if(placementSettings.autoAutoplay)startAutoplay()};ec.register({"user.autoplay_toggle":toggleAutoplay,"user.*":autoplayInterrupt,"size.mode_changed":sizeModeChanged,loaded:init},this)};var PrerollView=function(){var root=$("#"+
uniqueId+" .wp-volt-gal-preroll");var prerollDone=function(){root.removeClass("wp-volt-gal-ad-visible");state.blockUI=false;ec.report("ad.preroll_done")};var showPreroll=function(){root.addClass("wp-volt-gal-ad-visible");state.blockUI=true;var prerollArgs={type:"gallery",image:"",autoStart:false,primarySiteNode:galSettings.commercialNode,adZone:"auto",callback:prerollDone,galleryType:"embed"};if(galSettings.prerollZone)prerollArgs.adZone=galSettings.prerollZone;setTimeout(function(){},300)};var init=
function(){};ec.register({"ad.show_preroll":showPreroll,loaded:init},this)};var PieTimerWidget=function(wrapEl,options){var pieTemplateEl=mainRoot.find(".wp-volt-gal-templates .wp-volt-gal-pie").clone();var settings=$.extend({playing:true,time:1},options);var pieEl=pieTemplateEl.clone();var animEls=pieEl.find(".wp-volt-gal-pie-anim");animEls.css({"-webkit-animation-duration":settings.time+"s","-moz-animation-duration":settings.time+"s","-o-animation-duration":settings.time+"s","-ms-animation-duration":settings.time+
"s","animation-duration":settings.time+"s"});var play=function(){pieEl.addClass("wp-volt-gal-pie-playing")};var pause=function(){pieEl.removeClass("wp-volt-gal-pie-playing")};var destroy=function(){pieEl.remove()};if(settings.playing)play();wrapEl.append(pieEl);return{pause:pause,play:play,destroy:destroy}};var AdView=function(){var root=mainRoot.find(".wp-volt-gal-ad");var skipBtn=root.find(".wp-volt-gal-ad-skip");var skipText=skipBtn.find(".wp-volt-gal-ad-skiptext");var pieWrap=root.find(".wp-volt-gal-ad-pie");
var pieObj=null;var waiting=false;var showing=false;var active=false;var showInterstitial=function(){state.blockUI=true;active=true;waiting=false;pieWrap.empty();root.removeClass("wp-volt-gal-ad-viewing wp-volt-gal-ad-viewed");skipText.html("Skip Ad");pieObj=new PieTimerWidget(pieWrap,{playing:false,time:config.adTime});var interstitialText=mainRoot.find(".wp-volt-gal-templates .wp-volt-gal-interstitial-text").clone();mainRoot.find(".wp-volt-gal-details").before(interstitialText);if(typeof window.placeAd2==
"function"){$("#slug_bigbox_gallery").html('\x3cdiv id\x3d"wpni_adi_bigbox_gallery"\x3e\x3c/div\x3e');window.placeAd2(galSettings.commercialNode,"bigbox_gallery","ajax","")}else if(window.wpAd&&window.wpAd.meta_data)if(window.wpAd.availabeAds&&window.wpAd.availabeAds["slug_bigbox_gallery"]){$("#slug_bigbox_gallery")[0].render();window.wpAd.availabeAds["slug_bigbox_gallery"]=undefined}else $("#slug_bigbox_gallery")[0].refresh();mainRoot.find(".wp-volt-gal-main-nav").hide();root[0].offsetHeight;root.addClass("wp-volt-gal-ad-visible");
setTimeout(startInterstitial,200)};var startInterstitial=function(){showing=true;root.addClass("wp-volt-gal-ad-viewing");pieObj.play();setTimeout(interstitialDone,config.adTime*1E3+50)};var interstitialDone=function(){ec.report("ad.interstitial_viewed");root.removeClass("wp-volt-gal-ad-viewing").addClass("wp-volt-gal-ad-viewed");pieObj.pause();showing=false;state.blockUI=false;if(waiting)killInterstitial();mainRoot.find(".wp-volt-gal-interstitial-text").first().remove();var adSideArrows=mainRoot.find(".wp-volt-gal-main-nav").clone(true);
root.append(adSideArrows)};var killInterstitial=function(){root.removeClass("wp-volt-gal-ad-visible");ec.report("ad.interstitial_done");$("#slug_bigbox_gallery").empty();active=false;mainRoot.find(".wp-volt-gal-main-nav").show();root.find(".wp-volt-gal-main-nav").remove()};var userSkip=function(){if(!active)return;if(showing){waiting=true;skipText.html("Wait")}else killInterstitial()};var init=function(){skipBtn.click(userSkip)};ec.register({"ad.show_interstitial":showInterstitial,item_changed:userSkip,
loaded:init},this)};var PhotoView=function(){var root=mainRoot.find(".wp-volt-gal-photos");var titleOverlay=mainRoot.find(".wp-volt-gal-title-overlay");var titleOverlayHolder=titleOverlay.find(".wp-volt-gal-title-holder");var titleOverlayBackdrop=titleOverlay.find(".wp-volt-gal-title-backdrop");var itemEls=root.children();var lastIndex=null;var itemChanged=function(){if(state.itemType=="title"){var titleEl=itemEls.eq(state.itemIndex);titleOverlayHolder.empty().append(titleEl.find(".wp-volt-gal-title-holder").clone().children());
mainRoot.addClass("wp-volt-gal-on-title-slide");titleOverlayBackdrop.css("background-image",titleEl.css("background-image"))}else mainRoot.removeClass("wp-volt-gal-on-title-slide");moveSlider(state.itemIndex);loadPhotos();lastIndex=state.itemIndex};var moveSlider=function(position){root.removeAttr("style");if(placementSettings.transformProp){root.css(placementSettings.transformProp,"translateX("+position*-100+"%)");if(state.isFirstGallery){var currentSlide=root.find(".wp-volt-gal-slide").get(position);
var calcLeft=$(currentSlide).position().left/position;var diff=$(currentSlide)[0].getBoundingClientRect().width-calcLeft;root.css("margin-left",diff*position+"px")}}else root.css("margin-left",position*-100+"%")};var getNearestBreakpoint=function(width){for(var a=0;a<config.imageBreakpoints.length;a++)if(width<=config.imageBreakpoints[a])return config.imageBreakpoints[a];return-1};var calculateBreakpoints=function(){var curH=root.height();var curW=root.width();var ratio=curW/curH;var widthBreakpoint=
getNearestBreakpoint(curW);itemEls.each(function(i,el){var jqEl=$(el);try{var photoRatio=parseFloat(jqEl.data("ratio"));if(placementSettings.photoCover?photoRatio<ratio:photoRatio>=ratio)jqEl.data("imageBreakpoint",widthBreakpoint);else jqEl.data("imageBreakpoint",getNearestBreakpoint(photoRatio*curH))}catch(err){jqEl.data("imageBreakpoint",widthBreakpoint)}})};var getImageForBreakpoint=function(elData){if(elData.imageBreakpoint==-1)if(elData.image1200)return elData.image1200;else return elData.image.replace("/rw/",
"/rf/image_1200w/");if(elData["image"+elData.imageBreakpoint])return elData["image"+elData.imageBreakpoint];else return elData.image.replace("/rw/","/rf/image_"+elData.imageBreakpoint+"w/")};var loadIfNeeded=function(i,el){var jqEl=$(el);if(!jqEl.data("image"))return;var elData=jqEl.data();if(typeof elData.loadedWidth=="number"&&elData.loadedWidth>=elData.imageBreakpoint)return;var imgUrl=getImageForBreakpoint(elData);var imgPreload=new Image;$(imgPreload).on("load",{itemEl:jqEl,imgUrl:imgUrl},imgLoaded);
imgPreload.src=imgUrl;jqEl.data("loadedWidth",elData.imageBreakpoint)};var imgLoaded=function(event){event.data.itemEl.css("background-image","url('"+event.data.imgUrl+"')").addClass("wp-volt-gal-item-loaded")};var loadPhotos=function(){if(lastIndex==null);else if(lastIndex<state.itemIndex&&lastIndex+config.forwardBuffer>=state.itemIndex){var numJumped=state.itemIndex-lastIndex;itemEls.slice(state.itemIndex+config.forwardBuffer-numJumped,state.itemIndex+config.forwardBuffer).each(loadIfNeeded);return}else if(lastIndex>
state.itemIndex&&lastIndex-config.backBuffer<=state.itemIndex){numJumped=lastIndex-state.itemIndex;$(itemEls.slice(state.itemIndex-config.backBuffer,state.itemIndex-config.backBuffer+numJumped).get().reverse()).each(loadIfNeeded);return}var startIndex=state.itemIndex-config.backBuffer;startIndex>0?startIndex:0;var endIndex=state.itemIndex+config.forwardBuffer;endIndex<state.totalItems?endIndex:state.totalItems-1;itemEls.slice(state.itemIndex,endIndex).each(loadIfNeeded);$(itemEls.slice(startIndex,
state.itemIndex-1).get().reverse()).each(loadIfNeeded)};var resizedDebounce=function(){calculateBreakpoints();lastIndex=null;loadPhotos()};var galleryLoaded=function(){root.empty().append(state.nextGal.find(".wp-volt-gal-photos").children());itemEls=root.children();calculateBreakpoints();moveSlider(0)};var photoClicked=function(){if(state.isPromoStub)ec.report("user.next");else if(state.sizeMode=="small")if(state.fullscreen){ec.report("user.fullscreen_close",null,true);ec.report("size.resized");ec.report("size.resized_debounce")}else{ec.report("user.fullscreen",
null,true);ec.report("size.resized");ec.report("size.resized_debounce")}};var aspectRatio=function(){if(placementSettings.aspectRatioHeight&&galSettings.aspectRatio)mainRoot.find(".wp-volt-gal-main").css("padding-bottom",mainRoot.width()/galSettings.aspectRatio+"px")};var init=function(){calculateBreakpoints();root.click(photoClicked);aspectRatio()};ec.register({loaded:init,"size.resized_debounce":resizedDebounce,"size.resized":aspectRatio,item_changed:itemChanged,gallery_loaded:galleryLoaded,gallery_changed:loadPhotos},
this)};var MainNavView=function(){var closeBtn=mainRoot.find(".wp-volt-gal-close-fullscreen i.close");var prevBtn=mainRoot.find(".wp-volt-gal-main-nav-prev");var zoomBtn=mainRoot.find(".wp-volt-gal-main-nav-zoom");var nextBtn=mainRoot.find(".wp-volt-gal-main-nav-next");var closeClicked=function(){ec.report("user.fullscreen_close",null,true)};var prevClicked=function(){ec.report("user.prev")};var zoomClicked=function(){ec.report("user.fullscreen",null,true)};var nextClicked=function(){ec.report("user.next")};
var init=function(){prevBtn.click(prevClicked);zoomBtn.click(zoomClicked);nextBtn.click(nextClicked);closeBtn.click(closeClicked)};ec.register({loaded:init},this)};var CaptionView=function(){var root=mainRoot.find(".wp-volt-gal-details");var handleEl=root.children(".wp-volt-gal-details-handle");var wrapEl=root.children(".wp-volt-gal-details-wrap");var mainEl=wrapEl.children(".wp-volt-gal-details-main");var titleEl=mainEl.find(".wp-volt-gal-caption-title");var captionEl=mainEl.find(".wp-volt-gal-caption-text");
var creditEl=mainEl.find(".wp-volt-gal-caption-credit");var buyEl=mainEl.find(".wp-volt-gal-buy-link");var titleGalEl=mainRoot.find(".wp-volt-gal-slide-gal-title");var updateCaption=function(){populateCaption(state.itemIndex,state.itemData);adjustHeight(false)};var populateCaption=function(itemIndex,itemData){if(!!itemData.caption&&itemData.caption.toString().trim())captionEl.html(itemData.caption.toString().trim()).show();else captionEl.html("").hide();if(!!itemData.credit&&itemData.credit.toString().trim())creditEl.html(itemData.credit.toString().trim()).show();
else creditEl.html("").hide();if(!!itemData.title&&itemData.title.toString().trim())titleEl.html(itemData.title.toString().trim()).show();else titleEl.html("").hide();if(itemData.buy){var imageUrl=itemData.image;buyEl.attr("href",config.buyUrl.replace("[small_url]",encodeURIComponent(imageUrl.replace("/rw/","/rf/image_606w/"))).replace("[full_url]",encodeURIComponent(imageUrl))).addClass("wp-volt-gal-buyable")}else buyEl.removeClass("wp-volt-gal-buyable")};var toggleDetails=function(){root.toggleClass("expanded");
titleGalEl.toggleClass("wp-volt-gal-caption-expanded");adjustHeight(true)};var openDetails=function(){root.addClass("expanded");titleGalEl.addClass("wp-volt-gal-caption-expanded");adjustHeight(false)};var closeDetails=function(){root.removeClass("expanded");titleGalEl.removeClass("wp-volt-gal-caption-expanded");adjustHeight(false)};var adjustHeight=function(marginAlreadyAdded){if(state.fullscreen)if(root.hasClass("expanded")){var wrapChildren=wrapEl.children();var maxHeight=0;var origMarginBottom=
parseFloat(wrapEl.css("margin-bottom"));for(var a=0;a<wrapChildren.length;a++){var height=wrapChildren.eq(a).outerHeight();maxHeight=height>maxHeight?height:maxHeight}if(marginAlreadyAdded||$("#slug_fixedBottom:visible").length<=0)origMarginBottom=0;wrapEl.css("height",maxHeight+parseFloat(origMarginBottom)+"px")}else wrapEl.css("height","0px")};var adjustFullscreen=function(){if(state.fullscreen){var pixelDiff=mainRoot.find(".wp-volt-gal-main").outerHeight()-window.innerHeight;if(pixelDiff<0)pixelDiff=
0;pixelDiff+=25;var mobileBottomBlockAd=$("#slug_fixedBottom:visible");if(mobileBottomBlockAd.length>0){wrapEl.css("margin-bottom",mobileBottomBlockAd.css("height"));pixelDiff+=parseFloat(mobileBottomBlockAd.css("height"))}titleGalEl.css("margin-bottom",pixelDiff+"px")}else{titleGalEl.css("margin-bottom","");wrapEl.css("margin-bottom","")}};var getMaxHeight=function(){var maxHeight=0;var origHeight=wrapEl.height();wrapEl.css("height","").addClass("notransition");state.photoEls.each(function(i,el){if(i==
0)mainRoot.addClass("wp-volt-gal-on-first-slide");else if(i==1)mainRoot.removeClass("wp-volt-gal-on-first-slide");populateCaption(i+1,$(el).data());var curHeight=wrapEl.height();maxHeight=maxHeight>curHeight?maxHeight:curHeight});updateCaption();wrapEl.css("height",origHeight+"px").removeClass("notransition");wrapEl[0].offsetHeight;return maxHeight};var setMaxHeight=function(){var setHeight=getMaxHeight();if(setHeight>0)setHeight+="px";else setHeight="auto";wrapEl.css("height",setHeight)};var galleryLoaded=
function(){mainEl.empty().append(state.nextGal.find(".wp-volt-gal-details-main").children());titleEl=mainEl.find(".wp-volt-gal-caption-title");captionEl=mainEl.find(".wp-volt-gal-caption-text");creditEl=mainEl.find(".wp-volt-gal-caption-credit");buyEl=mainEl.find(".wp-volt-gal-buy-link")};var resizedDebounce=function(){if(state.fullscreen)adjustHeight(false);else setMaxHeight()};var init=function(){handleEl.click(toggleDetails)};ec.register({"user.details_open":openDetails,"user.details_close":closeDetails,
item_changed:updateCaption,"size.mode_changed":resizedDebounce,"size.resized_debounce":resizedDebounce,gallery_changed:resizedDebounce,gallery_loaded:galleryLoaded,"size.resized":adjustFullscreen,loaded:init},this)};var VotingController=function(){var voteRecorded=function(){ec.report("vote_recorded")};var userVote=function(action){state.itemEl.data("user-vote",action);var numVotes=state.itemEl.data("vote_"+action);numVotes=numVotes?numVotes+1:1;state.itemEl.data("vote_"+action,numVotes).attr("data-vote_"+
action,numVotes);var voteJSON={};voteJSON.vote_group=["GALLERY",galSettings.uuid,state.itemData.uuid].join("_");voteJSON.vote=action;$.post(config.votePostUrl,JSON.stringify(voteJSON),voteRecorded)};ec.register({"user.vote":userVote},this)};var VotingView=function(){var parentEl=mainRoot.find(".wp-volt-gal-details-wrap");var root=parentEl.find(".wp-volt-gal-voting");var answersEl=root.find(".wp-volt-gal-voting-options");var voteClicked=function(event){if(!root)return;if(root.hasClass("wp-volt-gal-user-voted"))return;
var optionEl=$(event.target);ec.report("user.vote",optionEl.data("action"));optionEl.attr("data-votes",parseInt(optionEl.attr("data-votes"))+1);root.addClass("wp-volt-gal-user-voted");optionEl.addClass("wp-volt-gal-selected")};var itemChanged=function(){if(!root)return;var numAnswers=answersEl.children().length;for(var a=0;a<numAnswers;a++){var optionEl=answersEl.children().eq(a);var optionVotes=state.itemData["vote_"+optionEl.data("action")];if(optionVotes)optionEl.attr("data-votes",optionVotes);
else optionEl.attr("data-votes",0)}answersEl.children().removeClass("wp-volt-gal-selected");root.removeClass("wp-volt-gal-user-voted");if(state.itemData.userVote){root.addClass("wp-volt-gal-user-voted");answersEl.find("[data-action\x3d"+state.itemData.userVote+"]").addClass("wp-volt-gal-selected")}};var initVoting=function(){mainRoot.addClass("wp-volt-gal-has-voting");root=parentEl.find(".wp-volt-gal-voting");answersEl=root.find(".wp-volt-gal-voting-options");answersEl.click(voteClicked)};var clearVoting=
function(){mainRoot.removeClass("wp-volt-gal-has-voting");answersEl.off("click");root.remove();root=null;answersEl=null};var galleryLoaded=function(){clearVoting();var newVotingRoot=state.nextGal.find(".wp-volt-gal-voting");if(newVotingRoot.length>0){parentEl.append(newVotingRoot);initVoting()}};var init=function(){if(root.length==0)clearVoting();else initVoting()};ec.register({loaded:init,gallery_loaded:galleryLoaded,item_changed:itemChanged},this)};var BarNavView=function(){var root=mainRoot.find(".wp-volt-gal-nav");
var nextEl=root.find(".wp-volt-gal-nav-next");var prevEl=root.find(".wp-volt-gal-nav-prev");var numberEl=root.find(".wp-volt-gal-nav-number");var curNumberEl=numberEl.find(".wp-volt-gal-nav-number-current");var itemChanged=function(){if(state.itemIndex+1>=state.totalItems&&!placementSettings.endMode=="circular")numberEl.hide();else numberEl.show();curNumberEl.html(state.itemIndex+1)};var showAd=function(){};var galleryLoaded=function(){numberEl.html(state.nextGal.find(".wp-volt-gal-nav-number").html());
curNumberEl=numberEl.find(".wp-volt-gal-nav-number-current")};var init=function(){prevEl.click(function(){ec.report("user.prev")});nextEl.click(function(){ec.report("user.next")})};ec.register({loaded:init,item_changed:itemChanged,"ad.show_interstitial":showAd,"ad.show_preroll":showAd,gallery_loaded:galleryLoaded},this)};var BarButtonsView=function(){var root=mainRoot.find(".wp-volt-gal-buttons");var rootParent=root.parent();var pieObj=null;var pieWrap=root.find(".wp-volt-gal-bar-pie");var autoplayBtn=
root.find(".wp-volt-gal-button-autoplay");var fullscreenBtn=root.find(".wp-volt-gal-button-fullscreen");var buttonsClicked=function(event){if(state.blockUI)return;var buttonEl=$(event.currentTarget);if(buttonEl.hasClass("wp-volt-gal-button-fullscreen")){ec.report("user.fullscreen",null,true);ec.report("size.resized");ec.report("size.resized_debounce")}else if(buttonEl.hasClass("wp-volt-gal-button-close")){ec.report("user.fullscreen_close",null,true);ec.report("size.resized");ec.report("size.resized_debounce")}else if(buttonEl.hasClass("wp-volt-gal-button-thumbs"))ec.report("user.thumbs_toggle");
else if(buttonEl.hasClass("wp-volt-gal-button-autoplay"))ec.report("user.autoplay_toggle")};var startAutoplayTimer=function(){if(pieObj!=null){pieObj.destroy();pieObj=null}pieObj=new PieTimerWidget(pieWrap,{playing:true,time:config.autoplayTime});autoplayBtn.addClass("wp-volt-gal-paused")};var stopAutoplayTimer=function(){pieObj.destroy();pieObj=null;autoplayBtn.removeClass("wp-volt-gal-paused")};var resizeButtons=function(){var fullscreenText=fullscreenBtn.find("span");if(rootParent.height()>40)fullscreenText.hide();
else{fullscreenText.show();if(rootParent.height()>40)fullscreenText.hide()}};var init=function(){root.on("click",".wp-volt-gal-button",buttonsClicked)};ec.register({"autoplay.start":startAutoplayTimer,"autoplay.next":startAutoplayTimer,"autoplay.stop":stopAutoplayTimer,"size.resized":resizeButtons,loaded:init},this)};var ExternalController=function(){var report=function(event,data){if(typeof window.wp_pb=="object"&&typeof window.wp_pb.report=="function")wp_pb.report(state.pbContentId,event,data)};
var adChanged=function(){report("ad_changed",galSettings.commercialNode)};var itemChanged=function(){report("item_changed",{gallery:galSettings,item:state.itemData,index:state.itemIndex})};var galleryChanged=function(){report("gallery_changed",galSettings)};ec.register({"ad.show_interstitial":adChanged,item_changed:itemChanged,gallery_changed:galleryChanged},this)};var init=function(){initFeature();new GalleryController;new AutoplayController;new ModeController;new TrackingController;new RootClassController;
new VotingController;new KeyController;if(placementSettings.isGalleryPage)new ExternalController;if(placementSettings.useTouchEvents)new TouchController;new PhotoView;new PrerollView;new AdView;new MainNavView;new CaptionView;new BarButtonsView;new BarNavView;new VotingView;window.wpVoltGal={placementSettings:placementSettings,galSettings:galSettings,state:state,config:config,ec:ec};ec.report("loaded")};init()};$(".wp-volt-gal.slideshow.unprocessed").each(function(i,el){if($(el).hasClass("wp-volt-gal-embed-promo"))$(el).find(".wp-volt-gal-embed-promo-container").on("click",
function(){new wpVoltronGallery($(el));$(el).removeClass("wp-volt-gal-embed-promo-hide");$(this).remove()});else{new wpVoltronGallery($(el));var title=$(this).data("title");var id=$(this).parent().get(0).id;if(id!==undefined&&id.indexOf("gallery-embed")>=0)$(this).find(".wp-volt-gal-main .wp-volt-gal-photos .wp-volt-gal-slide .wp-volt-gal-slide-gal-title").first().empty().append(title)}$(el).removeClass("unprocessed")})})(jQuery);