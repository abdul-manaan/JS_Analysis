/*
 * Shisa.class/1.1.2
 * Copyright (c) 2018 Rakuten Inc.
 * 2018-03-16 09:51:57
 */
!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){var n=void 0;for(n in t)y.call(t,n)&&(e[n]=t[n]);return e}function o(e){var t=new XMLHttpRequest,n=void 0;return"withCredentials"in t||"undefined"==typeof XDomainRequest?(t.open("POST",e),t.setRequestHeader("Content-Type","text/plain; charset=UTF-8"),t):(n=new XDomainRequest,n.open("POST",e),n)}function s(e){return e.replace(/^\s+/g,"")}function a(e){var t=void 0,n=void 0,r=void 0,i=void 0,o=document.cookie&&document.cookie.split(";");if(!o)return null;for(t=0;t<o.length;t++)if(r=o[t],-1!==(n=r.indexOf("="))&&s(window.decodeURIComponent(r.substr(0,n)))===e){try{i=window.decodeURIComponent(r.substr(n+1,r.length-n-1)),i=window.JSON.parse(i)}catch(e){}return i}return null}function u(e){var t=a("Rt"),n=parseInt(t?t.substr(t.length-3):0,16);return e=e.split("-"),n>=parseInt(e[0],16)&&n<=parseInt(e[1],16)}function c(e){var t=e?window.sessionStorage:window.localStorage;try{return t.setItem(d,"1"),t.removeItem(d),!0}catch(e){return!1}}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p="//rat.rakuten.co.jp/",h=604800,f=100,d="__STORAGE_TEST_KEY__",g=5e3,m=.5,v=(new Date).getTime(),w=v+String(Math.random()).substring(1),y=Object.prototype.hasOwnProperty,S=function(){function e(t){r(this,e),this.options=i({sendData:!0,useTimer:!0,hideErrors:!1,cacheErrors:!0,sendUnknown:!0,maxCachedErrors:f,cacheTime:h,timeLimit:g,sendPercentage:m,url:p},t),(100*Math.random()>this.options.sendPercentage||this.options.sendRange&&!u(this.options.sendRange))&&(this.options.sendData=!1),this.options.regExp&&(this.regExp=new RegExp(this.options.regExp,this.options.regExpFlags)),this.queue=[],this.list=[],this.ignored=[]}return l(e,[{key:"log",value:function(e){var t=this.regExp&&!this.regExp.exec(e.msg)?this.ignored:this.queue;e.timeOffset=(new Date).getTime()-v,t.push(e),this.list.push(e);var n=this;this.options.useTimer&&(clearTimeout(this.timer),this.timer=setTimeout(function(){return n.sendData()},this.options.timeLimit))}},{key:"sendData",value:function(){if(this.options.sendData&&0!==this.queue.length&&this.options.url){var e=o(this.options.url),t="cpkg_none=",n=[],r=void 0;for(r=0;r<this.queue.length;r++){var i=this.queue[r];if(!this.errorIsCached(i)){var s={group:void 0!==this.options.group?this.options.group:void 0,type:i.type,msg:i.msg||i.message,fileUrl:i.fileUrl||i.fileName||i.sourceURL,lineNumber:i.lineNumber||i.line,column:i.column||i.columnNumber,stack:i.stack};this.options.beforeSend&&"function"==typeof this.options.beforeSend&&this.options.beforeSend(s),s.sessionId=w,s.shisaVersion="1.1.2",s.start=v,s.page=window.location.href;var a={acc:1164,aid:1,etype:"pv",cks:null,ckp:null,cp:s};n.push(a)}}if(0===n.length)return void(this.queue=[]);if(t+=JSON.stringify(n),t.length>132e3){var u={acc:1164,aid:1,etype:"pv",cks:null,ckp:null,cp:{sessionId:w,start:v,apiError:"ERROR: RAT API POST request character limit exceeded. Check url manually."}};t="cpkg_none="+JSON.stringify(u)}try{e.send(t),this.queue=[]}catch(e){}}}},{key:"errorIsCached",value:function(e){if(this.options.cacheErrors&&c()){var t=window.location.href,n=e.message||e.msg||"",r=e.lineNumber||"",i=e.column||"",o=t+"_"+n+"_"+r+"_"+i,s="shisa:"+o;if(localStorage.getItem(s))return!0;if(localStorage.length>=this.options.maxCachedErrors){var a=0,u=void 0;for(u in localStorage)y.call(localStorage,u)&&0===u.indexOf("shisa:")&&a++;if(a>=this.options.maxCachedErrors)return!1}var l=(new Date).getTime()/1e3|0,p={d:!0,t:l+this.options.cacheTime};try{localStorage.setItem(s,JSON.stringify(p))}catch(e){}}return!1}},{key:"purgeCache",value:function(){if(c()){var e=void 0,t=(new Date).getTime()/1e3|0;for(e in localStorage)if(y.call(localStorage,e)&&0===e.indexOf("shisa:")){var n=JSON.parse(localStorage.getItem(e));n.t&&t>n.t&&localStorage.removeItem(e)}}}}]),e}();e.exports=S},,function(e,t,n){"use strict";window.Shisa=n(0)}]);
//# sourceMappingURL=Shisa.class.min.js.map